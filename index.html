<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app_title">VIDYUTSETU: Ancient Memory √ó Modern Learning</title>
    <!-- Load Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- NOTE: Tone.js is no longer used for Lofi music, but is kept for potential future features -->
<script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>

    <!-- Firebase Imports -->
<script type="module">
    // Expose Firebase imports to global scope (required for HTML scripting)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot, collection, query, where, getDocs, runTransaction, getDoc, setLogLevel, addDoc, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    
    window.firebase = {
        initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, 
        setPersistence, browserSessionPersistence, getFirestore, doc, setDoc, onSnapshot, 
        collection, query, where, getDocs, runTransaction, getDoc, setLogLevel, addDoc, serverTimestamp, deleteDoc
    };
    </script>

    <style>
        /* Custom scrollbar to match theme */
        body::-webkit-scrollbar {
            width: 10px;
        }
        body::-webkit-scrollbar-track {
            background: #F9F8F3; /* Off-White */
        }
        body.dark::-webkit-scrollbar-track {
            background: #313d30; /* Dark BG Premium - Updated to softer green */
        }
        body::-webkit-scrollbar-thumb {
            background-color: #A9C7A0; /* Sage Green */
            border-radius: 20px;
            border: 2px solid #F9F8F3;
        }
        body.dark::-webkit-scrollbar-thumb {
            background-color: #65875F; /* Forest Green */
            border: 2px solid #313d30; /* Dark BG Premium - Updated to softer green */
        }

        /* Gentle fade transition for page switching */
        .page-content {
            transition: opacity 0.5s ease-in-out;
        }
        
        /* Memory Palace Component Styles (Kept for Study Room) */
        .compartment {
            cursor: grab;
            position: absolute;
            min-width: 150px;
            min-height: 80px;
            transition: box-shadow 0.1s, transform 0.3s; /* Added transform transition */
        }
        .compartment:active {
            cursor: grabbing;
            box-shadow: 0 0 0 4px #D9B66A; /* Warm Gold Ring */
        }
        .compartment:hover { /* Added hover effect for drag targets */
             transform: scale(1.02);
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        
        /* Pomodoro Timer Style */
        #pomodoro-timer {
            font-size: 5rem;
            line-height: 1;
            font-family: 'Cormorant Garamond', serif;
            font-weight: 700;
        }

        /* Flashcard Styles */
        .perspective-1000 {
            perspective: 1000px;
        }
        .card-inner {
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .is-flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; 
            backface-visibility: hidden;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .card-front {
            background-color: #F9F8F3; /* Off-White */
            color: #333333;
        }
        .card-back {
            background-color: #A9C7A0; /* Sage Green */
            color: #333333;
            transform: rotateY(180deg);
        }
        .dark .card-front {
            background-color: #4a5746; /* Dark Card Soft - Updated */
            color: #F9F8F3;
        }
        .dark .card-back {
            background-color: #D9B66A; /* Warm Gold */
            color: #333333;
            transform: rotateY(180deg);
        }

        /* Falling Emojis Animation */
        @keyframes fall-and-sway {
            0% {
                transform: translate(0, -10vh) rotateZ(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                /* Use CSS variables for randomized landing position and rotation */
                transform: translate(var(--sway-x), 110vh) rotateZ(var(--sway-r)); 
                opacity: 0.5;
            }
        }
        .falling-emoji {
            position: absolute;
            font-size: 20px; 
            z-index: 1; /* Keeping z-index low so content sits above */
            animation: fall-and-sway linear infinite;
            pointer-events: none;
            /* Ensure the animation uses the custom properties defined in JS */
        }


        /* Mind Map Styles */
        .mind-map-node {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* Pill shape */
            font-weight: 700;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.3s, transform 0.1s;
            cursor: default;
        }
        .mind-map-node:hover {
            transform: scale(1.05);
        }
        .node-level-0 {
            background-color: #D9B66A; /* Warm Gold */
            color: #333333;
            font-size: 1.5rem;
            border: 2px solid #333333;
        }
        .node-level-1 {
            background-color: #A9C7A0; /* Sage Green */
            color: #333333;
            font-size: 1.125rem;
        }
        .node-level-2 {
            background-color: #F9F8F3; /* Off White */
            color: #333333;
            font-size: 1rem;
            border: 1px solid #A9C7A0;
        }
        .dark .node-level-0 {
            background-color: #D9B66A;
            color: #333333;
        }
        .dark .node-level-1 {
            background-color: #65875F; /* Forest Green */
            color: #F9F8F3;
        }
        .dark .node-level-2 {
            background-color: #4a5746; /* Dark Card Soft */
            color: #F9F8F3;
            border: 1px solid #65875F;
        }


        /* Modal Backdrop */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* 3D View Specific Styles */
        .walk-mode-backdrop {
            /* Using a placeholder image URL for 3D background mock */
            background: url('https://placehold.co/1920x1080/4a5746/f9f8f3?text=Smaranam+Palace+3D+View+Mockup') no-repeat center center;
            background-size: cover;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .walk-mode-backdrop.show {
            opacity: 1;
        }
        .walk-anchor {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s;
            text-shadow: 0 0 5px #000;
        }
        .walk-anchor:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        /* Custom track color for mood slider */
        input[type=range]::-webkit-slider-runnable-track {
            background: #A9C7A0; /* Sage Green */
            height: 8px;
            border-radius: 4px;
        }
        .dark input[type=range]::-webkit-slider-runnable-track {
            background: #65875F; /* Forest Green */
        }

        /* Custom Bar Chart Mock Styles */
        .bar-chart-bar {
            width: 20px;
            margin: 0 2px;
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease-out;
            min-height: 5px;
        }
    </style>

    <!-- Tailwind Configuration for Custom Colors and Fonts -->
<script>
        tailwind.config = {
            darkMode: 'class', // Enable dark mode based on 'dark' class on html tag
            theme: {
                extend: {
                    colors: {
                        'sage-green': '#A9C7A0',
                        'forest-green': '#65875F',
                        'warm-gold': '#D9B66A',
                        'off-white': '#F9F8F3',
                        'deep-charcoal': '#333333',
                        // NEW Premium Dark Mode Palette
                        'dark-bg-main': '#313d30', // UPDATED: Lighter, softer dark green/charcoal for background
                        'dark-card-soft': '#4a5746', // UPDATED: Lighter, richer dark sage for card backgrounds
                    },
                    fontFamily: {
                        'serif': ['Cormorant Garamond', 'serif'],
                        'sans': ['Lato', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 12px rgba(101, 135, 95, 0.1)', /* Subtle shadow with Forest Green hint */
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-off-white font-sans text-deep-charcoal min-h-screen flex flex-col dark:bg-dark-bg-main dark:text-off-white">

    <!-- Falling Elements Container (Fixed to background, z-index: 0) -->
<div id="falling-elements-container" class="fixed inset-0 overflow-hidden z-0 pointer-events-none"></div>

    <!-- Hidden YouTube Player for Lofi Music (Video ID: Jvgx5HHJ0qw) -->
<div id="lofi-player-container" class="fixed bottom-0 right-0 w-0 h-0 overflow-hidden opacity-0 pointer-events-none">
    <iframe id="lofi-iframe" width="0" height="0" frameborder="0" allow="autoplay; encrypted-media; fullscreen;" allowfullscreen></iframe>
</div>

    <!-- Navbar (z-50) -->
<nav class="sticky top-0 z-50 bg-sage-green/95 backdrop-blur-sm shadow-md dark:bg-dark-bg-main/95 dark:shadow-lg dark:shadow-forest-green/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <!-- Logo/Title -->
<a href="#" onclick="showPage('homepage'); return false;" class="text-2xl font-serif font-bold text-forest-green tracking-widest transition duration-300 hover:text-warm-gold dark:text-off-white dark:hover:text-warm-gold" data-i18n="app_name">
                VIDYUTSETU
            </a>
            
            <!-- Navigation Links -->
<div class="flex space-x-4 sm:space-x-8 items-center">
                <button onclick="showPage('homepage')" class="nav-link font-sans text-deep-charcoal hover:text-forest-green transition duration-200 focus:outline-none dark:text-off-white dark:hover:text-warm-gold" data-i18n="nav_home">Home</button>
                <button onclick="showPage('memory-palace-page')" class="nav-link font-sans text-deep-charcoal hover:text-forest-green transition duration-200 focus:outline-none dark:text-off-white dark:hover:text-warm-gold" data-i18n="nav_study_room">Study Room</button>
                <button onclick="location.href='studyroom.html'" 
class="nav-link font-sans text-deep-charcoal hover:text-forest-green transition duration-200 focus:outline-none dark:text-off-white dark:hover:text-warm-gold">
    Study Room (MVP)
</button>

                <button onclick="showPage('dashboard-page')" class="nav-link font-sans text-deep-charcoal font-bold hover:text-forest-green transition duration-200 focus:outline-none dark:text-off-white dark:hover:text-warm-gold" data-i18n="nav_dashboard">Dashboard</button>
                <!-- Removed dedicated Flashcards link -->
                <button onclick="showPage('features-page')" class="nav-link font-sans text-deep-charcoal hover:text-forest-green transition duration-200 focus:outline-none dark:text-off-white dark:hover:text-warm-gold" data-i18n="nav_features">Features</button>
                <button onclick="showPage('about-page')" class="nav-link font-sans text-deep-charcoal hover:text-forest-green transition duration-200 focus:outline-none dark:text-off-white dark:hover:text-warm-gold" data-i18n="nav_about">About</button>

                <!-- Lofi Toggle -->
<button id="lofi-play-btn" class="text-deep-charcoal hover:text-warm-gold dark:text-off-white dark:hover:text-warm-gold transition duration-300 p-2 rounded-full bg-transparent hover:bg-sage-green/50 dark:hover:bg-dark-card-soft/50" aria-label="Toggle Lofi Music" onclick="toggleLofi()">
                    <span id="lofi-icon" class="text-2xl">üé∂</span>
                </button>

                <!-- Language Selector -->
<select id="lang-selector" onchange="switchLanguage(this.value)" class="bg-sage-green/50 dark:bg-dark-card-soft text-deep-charcoal dark:text-off-white text-sm p-1 rounded-md cursor-pointer border border-forest-green dark:border-warm-gold">
    <option value="en" selected>EN</option>
    <option value="hi">HI</option>
</select>
                
                <!-- Dark Mode Toggle -->
<button id="dark-mode-toggle" class="text-deep-charcoal hover:text-warm-gold dark:text-off-white dark:hover:text-warm-gold transition duration-300 p-2 rounded-full bg-transparent hover:bg-sage-green/50 dark:hover:bg-dark-card-soft/50" aria-label="Toggle Dark Mode">
                    <!-- Sun Icon (Light Mode Default) -->
<svg id="sun-icon" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <!-- Moon Icon (Dark Mode) -->
<svg id="moon-icon" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
                
                <!-- Profile/Auth Mock Button -->
<button onclick="toggleAuthModal(true)" class="text-deep-charcoal hover:text-warm-gold dark:text-off-white dark:hover:text-warm-gold transition duration-300 p-2 rounded-full bg-transparent hover:bg-sage-green/50 dark:hover:bg-dark-card-soft/50" aria-label="User Profile and Login">
                    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- Authentication Modal (Hidden by Default) - z-1000 -->
    <div id="auth-modal" class="modal-backdrop hidden">
        <div class="bg-off-white dark:bg-dark-card-soft p-8 rounded-xl shadow-2xl max-w-sm w-full transition-all duration-300 transform scale-100 dark:border-2 dark:border-warm-gold/50">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-serif font-bold text-forest-green dark:text-warm-gold" data-i18n="auth_account_access">Account Access</h2>
                <button onclick="toggleAuthModal(false)" class="text-deep-charcoal/70 hover:text-red-600 dark:text-off-white/70 text-2xl">
                    &times;
                </button>
            </div>

            <div class="mb-4 p-3 rounded-lg bg-sage-green/30 dark:bg-dark-bg-main/50 text-sm">
                <p class="font-bold text-forest-green dark:text-off-white" data-i18n="auth_status">Status: <span id="auth-status-text" class="font-normal">Loading...</span></p>
                <p class="text-xs break-all mt-1">UID: <span id="auth-uid-text" class="font-mono">...</span></p>
            </div>

            <div id="auth-message" class="mb-4 text-sm text-center text-red-600 dark:text-warm-gold"></div>

            <form id="auth-form" class="space-y-4">
                <input type="email" id="auth-email" data-i18n-placeholder="auth_email_placeholder" placeholder="Email (mock@example.com)" class="w-full p-3 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white">
                <input type="password" id="auth-password" data-i18n-placeholder="auth_password_placeholder" placeholder="Password (mock password)" class="w-full p-3 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white">
                
                <div class="flex space-x-2">
                    <button type="button" onclick="mockAuth('login')" class="flex-1 bg-forest-green text-off-white font-bold py-2 rounded-md hover:bg-forest-green/90 transition shadow-md" data-i18n="auth_login">
                        Login
                    </button>
                    <button type="button" onclick="mockAuth('signup')" class="flex-1 bg-sage-green text-deep-charcoal font-bold py-2 rounded-md hover:bg-sage-green/90 transition shadow-md" data-i18n="auth_signup">
                        Sign Up
                    </button>
                </div>
            </form>
            
            <button onclick="mockAuth('signout')" class="w-full mt-4 bg-warm-gold text-deep-charcoal font-bold py-2 rounded-md hover:bg-warm-gold/90 transition shadow-md" data-i18n="auth_mock_signout">
                Mock Sign Out
            </button>
        </div>
    </div>
    
    <!-- 3D Walk Mode Modal (Hidden by Default) - z-999 -->
    <div id="walk-mode-modal" class="walk-mode-backdrop hidden">
        <div class="absolute inset-0 flex flex-col justify-center items-center p-8 bg-black/50 backdrop-blur-sm">
            <h2 class="text-4xl font-serif font-bold text-off-white mb-6 animate-pulse" data-i18n="walk_mode_title">Smaranam Palace - 3D Walk Mode</h2>
            <p class="text-lg text-warm-gold mb-12" data-i18n="walk_mode_subtitle">Click the glowing anchors to recall your topics and notes.</p>
            
            <div id="walk-mode-anchors" class="relative w-full h-full max-w-7xl">
                <!-- Anchors (Compartments/Notes) rendered here -->
            </div>
            
            <button onclick="toggle3DMode(false)" class="absolute top-4 right-4 bg-warm-gold text-deep-charcoal font-bold py-2 px-6 rounded-full shadow-lg hover:shadow-xl hover:bg-warm-gold/90 transition duration-300" data-i18n="walk_mode_exit">
                Exit View
            </button>
            
            <div id="recall-display" class="fixed bottom-10 p-4 max-w-md bg-deep-charcoal/80 text-off-white rounded-lg shadow-2xl border border-warm-gold transition duration-300 opacity-0 transform translate-y-full">
                <!-- Recall text appears here -->
            </div>
        </div>
    </div>


    <!-- Main Content Container (z-10 to layer above falling elements) -->
<main class="flex-grow relative z-10">
        
        <!-- 1. HOMEPAGE -->
<section id="homepage" class="page-content container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16">
            
            <!-- Hero Banner -->
<div class="relative bg-sage-green rounded-xl overflow-hidden p-8 md:p-16 text-center shadow-soft dark:bg-dark-card-soft dark:shadow-none z-20">
                
                <h1 class="font-serif text-5xl sm:text-7xl font-bold text-forest-green mb-4 animate-fade-in-down dark:text-off-white relative z-10" data-i18n="app_name_full">
                    VIDYUTSETU
                </h1>
                <p class="font-sans text-xl sm:text-2xl text-deep-charcoal/80 mb-8 max-w-2xl mx-auto dark:text-off-white/80 relative z-10" data-i18n="homepage_tagline">
                    Ancient Memory √ó Modern Learning.
                </p>
                <button onclick="showPage('features-page')" class="bg-warm-gold text-deep-charcoal font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl hover:bg-warm-gold/90 transition duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-warm-gold/50 relative z-10" data-i18n="homepage_explore_features">
                    Explore Features
                </button>
            </div>

            <!-- Short About Section -->
<div class="my-16 text-center max-w-4xl mx-auto">
                <h2 class="text-3xl font-serif font-bold text-forest-green mb-4 dark:text-warm-gold" data-i18n="homepage_mindful_path_title">A Mindful Path to Mastery</h2>
                <p class="text-lg text-deep-charcoal/70 dark:text-off-white/70" data-i18n="homepage_mindful_path_text">
                    Vidyutsetu helps you forge unbreakable connections between knowledge and memory. We blend time-tested visualization techniques with a suite of digital tools designed for deep, focused, and joyful study.
                </p>
            </div>

            <!-- Three Pillars of Retention (ADDED HOVER EFFECTS) -->
<div class="grid md:grid-cols-3 gap-8 my-16">
                
                <!-- Pillar 1: Visualization -->
<div class="bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-warm-gold transition-all duration-300 hover:shadow-xl hover:scale-[1.01] dark:bg-dark-card-soft dark:border-warm-gold z-20">
                    <div class="text-4xl text-forest-green mb-4 dark:text-warm-gold">
                        <!-- Icon: Eye/Memory Palace -->
<svg class="w-8 h-8 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.55 4.55a2 2 0 010 2.83l-1.42 1.42a2 2 0 01-2.83 0L12 15M21 12l-7 7m0 0l-7-7m7 7V3" />
                        </svg>
                    </div>
                    <h3 class="text-2xl font-serif font-bold text-forest-green mb-3 dark:text-off-white" data-i18n="pillar_visualization_title">Visualization</h3>
                    <p class="text-deep-charcoal/80 dark:text-off-white/80" data-i18n="pillar_visualization_text">
                        The Virtual Study Room (Memory Palace) creates strong spatial memory links, turning your knowledge into a physical, navigable space.
                    </p>
                </div>

                <!-- Pillar 2: Repetition -->
<div class="bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-warm-gold transition-all duration-300 hover:shadow-xl hover:scale-[1.01] dark:bg-dark-card-soft dark:border-warm-gold z-20">
                    <div class="text-4xl text-forest-green mb-4 dark:text-warm-gold">
                        <!-- Icon: Repeat/Cycle -->
<svg class="w-8 h-8 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.59-1.583a4.5 4.5 0 011.18 5.768L20 18m-2-12l2 2m0 0l-2 2m-2-2h-3m4 0H5c-1.104 0-2 1.12-2 2.5v1.25m8.58-12.24l-4 4" />
                        </svg>
                    </div>
                    <h3 class="text-2xl font-serif font-bold text-forest-green mb-3 dark:text-off-white" data-i18n="pillar_repetition_title">Repetition</h3>
                    <p class="text-deep-charcoal/80 dark:text-off-white/80" data-i18n="pillar_repetition_text">
                        Smart flashcards using Spaced Repetition (SRS), active recall quizzes, and voice chants solidify knowledge retention over time.
                    </p>
                </div>

                <!-- Pillar 3: Immersion -->
<div class="bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-warm-gold transition-all duration-300 hover:shadow-xl hover:scale-[1.01] dark:bg-dark-card-soft dark:border-warm-gold z-20">
                    <div class="text-4xl text-forest-green mb-4 dark:text-warm-gold">
                        <!-- Icon: Focus/Sun -->
<svg class="w-8 h-8 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </div>
                    <h3 class="2xl font-serif font-bold text-forest-green mb-3 dark:text-off-white" data-i18n="pillar_immersion_title">Immersion</h3>
                    <p class="text-deep-charcoal/80 dark:text-off-white/80" data-i18n="pillar_immersion_text">
                        Dedicated Focus Mode, Pomodoro timers, distraction penalties, and streak tracking build study discipline and ritual.
                    </p>
                </div>

            </div>

            <div class="text-center mt-12 z-20">
                <button onclick="showPage('features-page')" class="text-forest-green border border-forest-green font-bold py-2 px-6 rounded-full hover:bg-forest-green hover:text-off-white transition duration-300 focus:outline-none focus:ring-4 focus:ring-forest-green/50 dark:text-off-white dark:border-off-white dark:hover:bg-warm-gold dark:hover:text-deep-charcoal dark:focus:ring-warm-gold/50" data-i18n="homepage_see_full_features">
                    See Full Features
                </button>
            </div>

            <!-- Student/Alumni Testimonials section (ADDED HOVER EFFECTS) -->
<div class="my-20 z-20">
                <h2 class="text-3xl font-serif font-bold text-forest-green text-center mb-10 dark:text-warm-gold" data-i18n="homepage_learners_say_title">What Our Learners Say</h2>
                <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                    
                    <!-- Testimonial 1 -->
<div class="bg-sage-green/30 p-6 rounded-lg shadow-soft italic transition-all duration-300 hover:shadow-lg hover:scale-[1.01] dark:bg-dark-card-soft/50 z-20">
                        <p class="mb-4 dark:text-off-white/90" data-i18n="testimonial_1_quote">"The Virtual Study Room changed how I organize my thoughts. Placing concepts spatially made recalling complex material feel automatic and effortless. It‚Äôs truly a game-changer."</p>
                        <p class="font-bold text-sm text-forest-green dark:text-warm-gold" data-i18n="testimonial_1_author">‚Äî Anjali P., Medical Student</p>
                    </div>

                    <!-- Testimonial 2 -->
<div class="bg-sage-green/30 p-6 rounded-lg shadow-soft italic transition-all duration-300 hover:shadow-lg hover:scale-[1.01] dark:bg-dark-card-soft/50 z-20">
                        <p class="mb-4 dark:text-off-white/90" data-i18n="testimonial_2_quote">"The focus lock is exactly what I needed. Combined with the mood tracker, I've seen massive improvements in my daily discipline and overall study consistency. Highly recommended."</p>
                        <p class="font-bold text-sm text-forest-green dark:text-warm-gold" data-i18n="testimonial_2_author">‚Äî Rohan S., Software Engineer</p>
                    </div>

                </div>
            </div>

        </section>
        
        <!-- 4. MEMORY PALACE PAGE -->
<section id="memory-palace-page" class="page-content hidden container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16 relative z-10">
            <h2 class="text-4xl font-serif font-bold text-forest-green mb-6 text-center dark:text-warm-gold" data-i18n="study_room_title">Virtual Study Room (Smaranam Palace)</h2>
            <p class="text-center text-deep-charcoal/70 mb-8 dark:text-off-white/70" data-i18n="study_room_subtitle">Drag and drop compartments and notes to build your spatial memory links. Your changes are auto-saved.</p>
            
            <!-- Controls -->
<div class="flex flex-wrap justify-center space-x-4 mb-4 z-20">
                <button id="add-compartment-btn" class="bg-forest-green text-off-white font-bold py-2 px-4 rounded-full hover:bg-forest-green/90 transition duration-200 shadow-md" data-i18n="study_room_add_compartment">
                    + Add Compartment (Topic)
                </button>
                <button id="add-note-btn" class="bg-warm-gold text-deep-charcoal font-bold py-2 px-4 rounded-full hover:bg-warm-gold/90 transition duration-200 shadow-md" data-i18n="study_room_add_note">
                    + Add Note (Flashcard)
                </button>
                
                <!-- NEW: 3D Walk Mode Toggle -->
                <button onclick="toggle3DMode(true)" class="bg-warm-gold/20 text-warm-gold font-bold py-2 px-4 rounded-full hover:bg-warm-gold/30 transition duration-200 shadow-md" data-i18n="study_room_walk_mode">
                    Walk Mode (3D)
                </button>
                
                <div id="loading-indicator" class="text-forest-green font-sans py-2 px-4 hidden dark:text-warm-gold" data-i18n="study_room_saving">Saving...</div>
            </div>
            
            <!-- Memory Palace Canvas -->
<div id="palace-canvas" class="relative w-full h-[600px] border-4 border-sage-green rounded-xl shadow-inner overflow-hidden dark:border-forest-green z-20" style="background-color: #A9C7A033;">
                <div id="loading-data-message" class="absolute inset-0 flex items-center justify-center text-forest-green text-2xl font-serif dark:text-warm-gold" data-i18n="study_room_loading">
                    Loading your Study Room...
                </div>
                <!-- Compartments and Notes will be rendered here by JS -->
</div>
        </section>

        <!-- 5. DASHBOARD PAGE (REFACTORED TO MATCH SCREENSHOT) -->
<section id="dashboard-page" class="page-content hidden container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16 relative z-10">
            <!-- Header Area -->
            <div class="max-w-7xl mx-auto mb-8 flex justify-between items-start">
                <div>
                    <h2 class="text-4xl font-serif font-bold text-forest-green dark:text-sage-green" data-i18n="dashboard_welcome_back">Welcome Back</h2>
                    <p class="text-lg text-deep-charcoal/70 dark:text-off-white/70" data-i18n="dashboard_continue_journey">Continue your mindful learning journey</p>
                </div>
                <!-- LOGOUT REMOVED FROM HERE -->
            </div>

            <!-- Tab Navigation (Updated to link to new pages) -->
            <div class="flex space-x-1 mb-10 overflow-x-auto border-b border-sage-green/50 dark:border-dark-card-soft/50 pb-1">
                <!-- Active Tab: Overview -->
                <button onclick="showPage('dashboard-page')" class="px-4 py-2 font-bold rounded-t-lg bg-sage-green/50 text-deep-charcoal dark:bg-dark-card-soft dark:text-warm-gold border-b-2 border-forest-green dark:border-warm-gold" data-i18n="tab_overview">Overview</button>
                <!-- Inactive Tabs: Link to existing pages -->
                <button onclick="showPage('memory-palace-page')" class="px-4 py-2 rounded-t-lg text-deep-charcoal/70 hover:bg-sage-green/50 dark:text-off-white/70 dark:hover:bg-dark-card-soft/50" data-i18n="nav_study_room">Study Room</button>
                <button onclick="showPage('features-page')" class="px-4 py-2 rounded-t-lg text-deep-charcoal/70 hover:bg-sage-green/50 dark:text-off-white/70 dark:hover:bg-dark-card-soft/50" data-i18n="nav_features">Features</button>
                <button onclick="showPage('mood-dashboard-page')" class="px-4 py-2 rounded-t-lg text-deep-charcoal/70 hover:bg-sage-green/50 dark:text-off-white/70 dark:hover:bg-dark-card-soft/50" data-i18n="tab_focus">Focus</button>
                <button onclick="showPage('progress-page')" class="px-4 py-2 rounded-t-lg text-deep-charcoal/70 hover:bg-sage-green/50 dark:text-off-white/70 dark:hover:bg-dark-card-soft/50" data-i18n="nav_progress">Progress</button>
                <button onclick="showPage('groups-page')" class="px-4 py-2 rounded-t-lg text-deep-charcoal/70 hover:bg-sage-green/50 dark:text-off-white/70 dark:hover:bg-dark-card-soft/50" data-i18n="nav_groups">Groups</button>
            </div>

            <!-- Main Content Area: Metric Cards (3 columns) -->
            <div class="grid lg:grid-cols-3 gap-8 max-w-7xl mx-auto mb-16">
                
                <!-- Card 1: Study Rooms -->
                <div class="bg-off-white p-6 rounded-xl shadow-soft border border-sage-green/50 dark:bg-dark-card-soft dark:border-forest-green z-20 transition-all duration-300 hover:shadow-xl">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="text-3xl text-warm-gold">üè†</span>
                        <p id="study-room-count-display" class="text-4xl font-serif font-bold text-forest-green dark:text-off-white">0</p>
                        <p class="text-lg text-deep-charcoal/70 dark:text-off-white/70" data-i18n="metric_study_rooms">Study Rooms</p>
                    </div>
                    <button onclick="showPage('memory-palace-page')" class="w-full bg-sage-green text-deep-charcoal font-bold py-2 rounded-md hover:bg-sage-green/90 transition shadow-md dark:bg-dark-bg-main dark:text-off-white" data-i18n="metric_create_room">
                        Create Room
                    </button>
                </div>

                <!-- Card 2: Day Streak / Focus Status -->
                <div class="bg-off-white p-6 rounded-xl shadow-soft border border-sage-green/50 dark:bg-dark-card-soft dark:border-forest-green z-20 transition-all duration-300 hover:shadow-xl">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="text-3xl text-warm-gold">üéØ</span>
                        <!-- Updated to use existing ID for Streak Counter -->
                        <p id="streak-counter" class="text-4xl font-serif font-bold text-forest-green dark:text-off-white">4</p>
                        <p class="text-lg text-deep-charcoal/70 dark:text-off-white/70" data-i18n="metric_day_streak">Day Streak</p>
                    </div>
                    <!-- REPLACED BUTTON with a management link -->
                    <button onclick="showPage('dashboard-page')" class="w-full bg-sage-green text-deep-charcoal font-bold py-2 rounded-md hover:bg-sage-green/90 transition shadow-md dark:bg-dark-bg-main dark:text-off-white" data-i18n="metric_manage_focus">
                        Manage Focus Settings
                    </button>
                </div>

                <!-- Card 3: Flashcards -->
                <div class="bg-off-white p-6 rounded-xl shadow-soft border border-sage-green/50 dark:bg-dark-card-soft dark:border-forest-green z-20 transition-all duration-300 hover:shadow-xl">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="text-3xl text-warm-gold">üìö</span>
                        <!-- Updated ID to be distinct, logic updated in JS -->
                        <p id="flashcard-count-display" class="text-4xl font-serif font-bold text-forest-green dark:text-off-white">4</p>
                        <p class="text-lg text-deep-charcoal/70 dark:text-off-white/70" data-i18n="metric_flashcards">Flashcards</p>
                    </div>
                    <button onclick="showPage('features-page');" class="w-full bg-sage-green text-deep-charcoal font-bold py-2 rounded-md hover:bg-sage-green/90 transition shadow-md dark:bg-dark-bg-main dark:text-off-white" data-i18n="metric_create_flashcard">
                        Create Flashcard
                    </button>
                </div>
            </div> <!-- End Metric Cards -->
            
            <!-- Quick Actions Section -->
            <h3 class="text-2xl font-serif font-bold text-forest-green mb-6 dark:text-warm-gold" data-i18n="quick_actions_title">Quick Actions</h3>

            <div class="grid md:grid-cols-2 gap-8 max-w-7xl mx-auto">
                <!-- Action 1: Log Mood (Now links to the new page) -->
                <div onclick="showPage('mood-dashboard-page')" class="bg-off-white p-6 rounded-xl shadow-soft border border-sage-green/50 dark:bg-dark-card-soft dark:border-forest-green z-20 transition-all duration-300 hover:shadow-xl cursor-pointer">
                    <h4 class="text-xl font-sans font-bold text-deep-charcoal dark:text-off-white mb-2" data-i18n="quick_action_log_mood_title">Log Mood</h4>
                    <p class="text-sm text-deep-charcoal/70 dark:text-off-white/70 mb-4" data-i18n="quick_action_log_mood_subtitle">Track your emotional state post-session for better mindfulness.</p>
                    <div class="flex space-x-2">
                        <button class="text-3xl hover:scale-110 transition" onclick="selectMood('Excellent')">üòä</button>
                        <button class="text-3xl hover:scale-110 transition" onclick="selectMood('Struggling')">üò•</button>
                        <button class="text-3xl hover:scale-110 transition" onclick="selectMood('Tired')">üò¥</button>
                        <button class="text-3xl hover:scale-110 transition" onclick="selectMood('Focused')">üß†</button>
                    </div>
                </div>

                <!-- Action 2: Study Groups (Mock) -->
                <div onclick="showPage('groups-page')" class="bg-off-white p-6 rounded-xl shadow-soft border border-sage-green/50 dark:bg-dark-card-soft dark:border-forest-green z-20 transition-all duration-300 hover:shadow-xl cursor-pointer">
                    <h4 class="text-xl font-sans font-bold text-deep-charcoal dark:text-off-white mb-2" data-i18n="quick_action_study_groups_title">Study Groups</h4>
                    <p class="text-sm text-deep-charcoal/70 dark:text-off-white/70 mb-4" data-i18n="quick_action_study_groups_subtitle">Collaborate with peers. (Now Functional!)</p>
                    <button onclick="showPage('groups-page')" class="w-full bg-sage-green text-deep-charcoal font-bold py-2 rounded-md hover:bg-sage-green/90 transition shadow-md dark:bg-dark-bg-main dark:text-off-white" data-i18n="quick_action_join_group">
                        Browse Shared Topics
                    </button>
                </div>
            </div> <!-- End Quick Actions -->
            
            <!-- Focus Details & Settings (Contains Pomodoro Timer Info, Duration Setting, and Start/Pause Button) -->
            <div class="mt-16 bg-off-white p-6 rounded-xl shadow-soft border-t-4 border-sage-green dark:bg-dark-card-soft dark:border-forest-green z-20 max-w-lg mx-auto">
                <h4 class="text-xl font-serif font-bold text-deep-charcoal dark:text-off-white mb-4" data-i18n="focus_details_title">Focus Details & Settings</h4>
                
                <!-- Display Current Focus Session/Time -->
                <div class="text-center mb-6">
                    <div id="pomodoro-timer" class="text-forest-green text-5xl font-serif font-bold dark:text-warm-gold">25:00</div>
                    <div id="pomodoro-status" class="text-lg font-sans text-warm-gold dark:text-sage-green">Study Focus</div>
                </div>

                <!-- NEW: Session Duration Input -->
                <div class="flex justify-between items-center mb-4 border-t border-sage-green/50 dark:border-forest-green/50 py-3">
                    <p class="text-deep-charcoal/80 dark:text-off-white/80 font-bold" data-i18n="focus_session_duration">Focus Session Duration (Mins):</p>
                    <input type="number" id="focus-duration-input" value="25" min="5" max="60"
                        onchange="setFocusDuration(this.value)"
                        class="w-16 p-1 border border-forest-green rounded-md text-center focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white">
                </div>
                
                <!-- Daily Pomodoro Target Input (Retained) -->
                <div class="flex justify-between items-center mb-4 border-b border-sage-green/50 dark:border-forest-green/50 py-3">
                    <p class="text-deep-charcoal/80 dark:text-off-white/80 font-bold" data-i18n="focus_daily_target">Daily Pomodoro Target (Units):</p>
                    <input type="number" id="daily-pomodoros-target" value="4" min="1" max="20"
                        onchange="setDailyTarget(this.value)"
                        class="w-16 p-1 border border-forest-green rounded-md text-center focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white">
                </div>
                
                <!-- Today's Progress -->
                <div class="flex justify-between items-center mb-6">
                    <p class="text-deep-charcoal/80 dark:text-off-white/80 font-bold" data-i18n="focus_today_progress">Today's Completed Pomodoros:</p>
                    <p id="target-progress" class="text-2xl font-sans text-forest-green font-bold dark:text-sage-green">0 / 4</p>
                </div>

                <!-- MOVED Start/Pause Button -->
                <button id="pomodoro-start" onclick="toggleTimer()" class="w-full bg-forest-green text-off-white font-bold py-3 rounded-md hover:bg-forest-green/90 transition duration-200 shadow-md" data-i18n="metric_start_focus">
                    Start Focus
                </button>
            </div>
            
            <!-- Keeping the Reset Button hidden for functionality/debug access -->
            <button id="pomodoro-reset" onclick="resetTimer()" class="hidden"></button>
        </section>


        <!-- 6. NEW MOOD DASHBOARD PAGE -->
<section id="mood-dashboard-page" class="page-content hidden container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16 relative z-10 max-w-3xl">
            <h2 class="text-4xl font-serif font-bold text-forest-green mb-2 text-center dark:text-sage-green" data-i18n="mood_dashboard_title">Mood Dashboard</h2>
            <p class="text-center text-lg text-deep-charcoal/70 mb-10 dark:text-off-white/70" data-i18n="mood_dashboard_subtitle">Track your emotional and energy levels for mindful awareness</p>

            <!-- Mood Logging Card -->
            <div class="bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-forest-green dark:bg-dark-card-soft dark:border-sage-green z-20">
                <h3 class="text-xl font-sans font-bold text-deep-charcoal dark:text-off-white mb-6" data-i18n="mood_how_feeling">How are you feeling today?</h3>

                <!-- Mood Selection Buttons -->
                <div class="flex justify-around space-x-2 mb-8">
                    <!-- Mood 1: Excellent -->
                    <button class="mood-option p-2 rounded-xl text-center flex-1 transition duration-200 border-2 border-transparent hover:border-forest-green dark:hover:border-sage-green" data-mood="Excellent" data-emoji="üòä" onclick="setMood('Excellent')">
                        <span class="text-4xl block">üòä</span>
                        <span class="text-sm mt-1 text-deep-charcoal/80 dark:text-off-white/80" data-i18n="mood_excellent">Excellent</span>
                    </button>
                    <!-- Mood 2: Good -->
                    <button class="mood-option p-2 rounded-xl text-center flex-1 transition duration-200 border-2 border-transparent hover:border-forest-green dark:hover:border-sage-green" data-mood="Good" data-emoji="üôÇ" onclick="setMood('Good')">
                        <span class="text-4xl block">üôÇ</span>
                        <span class="text-sm mt-1 text-deep-charcoal/80 dark:text-off-white/80" data-i18n="mood_good">Good</span>
                    </button>
                    <!-- Mood 3: Okay -->
                    <button class="mood-option p-2 rounded-xl text-center flex-1 transition duration-200 border-2 border-transparent hover:border-forest-green dark:hover:border-sage-green" data-mood="Okay" data-emoji="üòê" onclick="setMood('Okay')">
                        <span class="text-4xl block">üòê</span>
                        <span class="text-sm mt-1 text-deep-charcoal/80 dark:text-off-white/80" data-i18n="mood_okay">Okay</span>
                    </button>
                    <!-- Mood 4: Struggling -->
                    <button class="mood-option p-2 rounded-xl text-center flex-1 transition duration-200 border-2 border-transparent hover:border-forest-green dark:hover:border-sage-green" data-mood="Struggling" data-emoji="üòü" onclick="setMood('Struggling')">
                        <span class="text-4xl block">üòü</span>
                        <span class="text-sm mt-1 text-deep-charcoal/80 dark:text-off-white/80" data-i18n="mood_struggling">Struggling</span>
                    </button>
                    <!-- Mood 5: Exhausted -->
                    <button class="mood-option p-2 rounded-xl text-center flex-1 transition duration-200 border-2 border-transparent hover:border-red-600" data-mood="Exhausted" data-emoji="ü•µ" onclick="setMood('Exhausted')">
                        <span class="text-4xl block">ü•µ</span>
                        <span class="text-sm mt-1 text-deep-charcoal/80 dark:text-off-white/80" data-i18n="mood_exhausted">Exhausted</span>
                    </button>
                </div>

                <!-- Energy Level Slider -->
                <label for="energy-level" class="text-sm font-bold text-deep-charcoal dark:text-off-white mb-2 block" data-i18n="mood_energy_level">Energy Level: <span id="energy-value">3</span>/5</label>
                <div class="flex items-center mb-6">
                    <input type="range" id="energy-level" min="1" max="5" value="3" 
                        class="w-full h-2 bg-sage-green/50 rounded-lg appearance-none cursor-pointer range-lg focus:outline-none dark:bg-dark-bg-main/50"
                        oninput="document.getElementById('energy-value').textContent = this.value">
                    <span class="ml-3 text-lg">‚ö°</span>
                </div>

                <!-- Notes Input -->
                <label for="mood-notes" class="text-sm font-bold text-deep-charcoal dark:text-off-white mb-2 block" data-i18n="mood_notes_title">Notes (optional)</label>
                <textarea id="mood-notes" rows="3" data-i18n-placeholder="mood_notes_placeholder" placeholder="What's on your mind?"
                    class="w-full p-3 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white"></textarea>
                
                <!-- Log Button -->
                <button onclick="logMoodEntry()" class="w-full mt-6 bg-forest-green text-off-white font-bold py-3 rounded-md hover:bg-forest-green/90 transition shadow-md dark:bg-sage-green dark:text-deep-charcoal" data-i18n="mood_log_entry">
                    Log Mood Entry
                </button>
            </div> <!-- End Mood Logging Card -->

            <!-- Recent Check-ins List -->
            <div class="mt-10 max-w-3xl mx-auto">
                <h3 class="2xl font-serif font-bold text-forest-green mb-6 dark:text-warm-gold" data-i18n="mood_recent_checkins">Recent Check-ins</h3>
                <div id="recent-checkins" class="space-y-4">
                    <!-- Entries injected here by JS -->
                </div>
            </div>

        </section>

        <!-- 7. PROGRESS PAGE (NEW) -->
<section id="progress-page" class="page-content hidden container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16 relative z-10 max-w-5xl">
            <h2 class="text-4xl font-serif font-bold text-forest-green mb-2 text-center dark:text-sage-green" data-i18n="progress_title">Learning Progress Summary</h2>
            <p class="text-center text-lg text-deep-charcoal/70 mb-10 dark:text-off-white/70" data-i18n="progress_subtitle">Visualizing your Dharana (Focus) and Smaranam (Recall) efforts.</p>

            <div class="grid md:grid-cols-3 gap-8 mb-12">
                
                <!-- Metric 1: Study Streak -->
                <div class="bg-off-white p-6 rounded-xl shadow-soft border-l-4 border-warm-gold dark:bg-dark-card-soft dark:border-warm-gold flex flex-col items-center text-center">
                    <p class="text-6xl font-serif font-bold text-forest-green dark:text-off-white" id="progress-streak-display">4</p>
                    <p class="text-md font-sans text-deep-charcoal/80 dark:text-off-white/80" data-i18n="progress_streak_days">Study Streak Days</p>
                </div>
                
                <!-- Metric 2: Pomodoros Completed Today -->
                <div class="bg-off-white p-6 rounded-xl shadow-soft border-l-4 border-forest-green dark:bg-dark-card-soft dark:border-forest-green flex flex-col items-center text-center">
                    <p class="text-6xl font-serif font-bold text-forest-green dark:text-off-white" id="progress-pomodoros-today">0</p>
                    <p class="text-md font-sans text-deep-charcoal/80 dark:text-off-white/80" data-i18n="focus_today_progress">Today's Completed Pomodoros</p>
                </div>
                
                <!-- Metric 3: Total Focus Sessions -->
                <div class="bg-off-white p-6 rounded-xl shadow-soft border-l-4 border-sage-green dark:bg-dark-card-soft dark:border-sage-green flex flex-col items-center text-center">
                    <p class="text-6xl font-serif font-bold text-forest-green dark:text-off-white" id="progress-total-sessions-display">12</p>
                    <p class="text-md font-sans text-deep-charcoal/80 dark:text-off-white/80" data-i18n="progress_total_sessions">Total Focus Sessions</p>
                </div>
            </div>

            <!-- Chart Mockup -->
            <div class="bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-forest-green dark:bg-dark-card-soft dark:border-sage-green">
                <h3 class="text-2xl font-serif font-bold text-deep-charcoal mb-6 dark:text-off-white" data-i18n="progress_weekly_chart">Weekly Focus Activity (Pomodoros)</h3>
                
                <div id="weekly-chart" class="flex justify-around items-end h-64 border-b border-l border-sage-green/50 dark:border-forest-green/50 p-2">
                    <!-- Bars injected by JS (Mock Data) -->
                </div>
                <div id="chart-labels" class="flex justify-around text-xs text-deep-charcoal/70 dark:text-off-white/70 mt-1">
                    <span>Mon</span>
                    <span>Tue</span>
                    <span>Wed</span>
                    <span>Thu</span>
                    <span>Fri</span>
                    <span>Sat</span>
                    <span>Sun</span>
                </div>
            </div>

        </section>

        <!-- 8. GROUPS PAGE (NEW) -->
<section id="groups-page" class="page-content hidden container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16 relative z-10 max-w-4xl">
            <h2 class="text-4xl font-serif font-bold text-forest-green mb-2 text-center dark:text-sage-green" data-i18n="groups_title">Collaborative Study Topics</h2>
            <p class="text-center text-lg text-deep-charcoal/70 mb-10 dark:text-off-white/70" data-i18n="groups_subtitle">Share and view topics with the wider Vidyutsetu community.</p>

            <!-- Topic Submission Card -->
            <div class="bg-off-white p-6 rounded-xl shadow-soft border-t-4 border-warm-gold dark:bg-dark-card-soft dark:border-warm-gold mb-10">
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <input type="text" id="group-topic-input" data-i18n-placeholder="groups_input_placeholder" placeholder="Enter a shared study topic (e.g., Quantum Entanglement)"
                        class="w-full p-3 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white text-base">
                    
                    <button id="add-topic-btn" onclick="addStudyTopic()" class="flex-shrink-0 bg-forest-green text-off-white font-bold py-3 px-6 rounded-md hover:bg-forest-green/90 transition shadow-md" data-i18n="groups_add_topic">
                        Share Topic
                    </button>
                </div>
                <p id="groups-message" class="text-sm mt-3 text-red-600 dark:text-warm-gold hidden"></p>
            </div>

            <!-- Shared Topics List -->
            <div class="bg-off-white p-6 rounded-xl shadow-soft border-t-4 border-forest-green dark:bg-dark-card-soft dark:border-sage-green">
                <h3 class="2xl font-serif font-bold text-deep-charcoal mb-4 dark:text-off-white" data-i18n="groups_shared_list">Shared Topics List</h3>
                <div id="shared-topics-list" class="space-y-3">
                    <!-- Topics dynamically rendered here -->
                </div>
                <div id="groups-loading" class="text-center text-forest-green dark:text-sage-green mt-4" data-i18n="study_room_loading">Loading topics...</div>
            </div>
        </section>

        <!-- 2. FEATURES HUB PAGE (NOW CONTAINS FUNCTIONAL COMPONENTS DIRECTLY) -->
<section id="features-page" class="page-content hidden container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16 relative z-10">
            <h2 class="text-4xl font-serif font-bold text-forest-green mb-12 text-center dark:text-warm-gold" data-i18n="features_hub_title">Interactive Feature Hub</h2>
            
            <!-- Link Cards (Study Room, Focus) - Top Row (4 columns) -->
<div class="max-w-7xl mx-auto grid lg:grid-cols-4 md:grid-cols-2 gap-8 mb-16">

                <!-- 1. VIRTUAL STUDY ROOM (Link to dedicated page) -->
<div class="p-6 bg-off-white dark:bg-dark-card-soft rounded-xl shadow-soft border-t-4 border-warm-gold transition-all duration-300 hover:shadow-xl hover:scale-[1.01] cursor-pointer z-20" onclick="showPage('memory-palace-page')">
                    <h3 class="2xl font-serif font-bold text-forest-green mb-2 dark:text-off-white" data-i18n="feature_memory_palace_title">Memory Palace (Loci)</h3>
                    <p class="text-deep-charcoal/70 dark:text-off-white/80" data-i18n="feature_memory_palace_subtitle">Spatial learning environment. **(GO TO STUDY ROOM)**</p>
                </div>

                <!-- 2. FOCUS SYSTEM (Link to dedicated page) -->
<div class="p-6 bg-off-white dark:bg-dark-card-soft rounded-xl shadow-soft border-t-4 border-forest-green transition-all duration-300 hover:shadow-xl hover:scale-[1.01] cursor-pointer z-20" onclick="showPage('dashboard-page')">
                    <h3 class="2xl font-serif font-bold text-deep-charcoal mb-2 dark:text-off-white" data-i18n="feature_focus_system_title">Focus System (Dharana)</h3>
                    <p class="text-deep-charcoal/70 dark:text-off-white/80" data-i18n="feature_focus_system_subtitle">Pomodoro Timer, focus lock, and streak tracking. **(GO TO DASHBOARD)**</p>
                </div>

                <!-- 6. MIND MAPS & FLOWCHARTS (Mockup - Now a link to a functional module below) -->
<div class="p-6 bg-off-white dark:bg-dark-card-soft rounded-xl shadow-soft border-t-4 border-forest-green transition-all duration-300 hover:shadow-xl hover:scale-[1.01] z-20" onclick="document.getElementById('mindmap-functional-area').scrollIntoView({ behavior: 'smooth' });">
                    <h3 class="2xl font-serif font-bold text-deep-charcoal mb-2 dark:text-off-white" data-i18n="feature_mind_maps_title">Mind Maps Builder</h3>
                    <div class="w-full h-16 bg-sage-green/30 rounded-lg flex items-center justify-center mt-3 border-2 border-dashed border-forest-green/50 dark:bg-dark-card-soft/50 dark:border-off-white/50">
                        <p class="text-forest-green/70 text-sm dark:text-off-white/70" data-i18n="feature_mind_maps_generator_placeholder">Sankalpa View Generator</p>
                    </div>
                    <p class="text-deep-charcoal/70 dark:text-off-white/80 mt-2" data-i18n="feature_mind_maps_subtitle_2">Visualize hierarchies and relationships between concepts.</p>
                </div>
                
                <!-- 7. COLLABORATION (UPDATED to link to collaboration section below) -->
<div class="p-6 bg-off-white dark:bg-dark-card-soft rounded-xl shadow-soft border-t-4 border-warm-gold transition-all duration-300 hover:shadow-xl hover:scale-[1.01] cursor-pointer z-20" onclick="document.getElementById('collaboration-functional-area').scrollIntoView({ behavior: 'smooth' });">
                    <h3 class="2xl font-serif font-bold text-deep-charcoal mb-2 dark:text-off-white" data-i18n="feature_collaboration_title">Vidyut Mitra (Peer Match)</h3>
                    <div class="w-full h-16 bg-warm-gold/30 rounded-lg flex items-center justify-center mt-3 border-2 border-dashed border-warm-gold/50 dark:bg-dark-card-soft/50 dark:border-off-white/50">
                        <p class="text-deep-charcoal/70 text-sm dark:text-warm-gold/70" data-i18n="feature_collaboration_peer_match_placeholder">Find a Study Partner</p>
                    </div>
                    <p class="text-deep-charcoal/70 dark:text-off-white/80 mt-2" data-i18n="feature_collaboration_subtitle">Shared rooms and study-mate matching are now live!</p>
                </div>
            </div>

            <!-- AI TOOLS - Full Width Sections -->
<div class="max-w-7xl mx-auto space-y-16">
                
                <!-- AI MIND MAP GENERATOR (Sankalpa View) - NEW FULL WIDTH SECTION -->
<div id="mindmap-functional-area" class="max-w-4xl mx-auto bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-forest-green dark:bg-dark-card-soft dark:border-sage-green z-20">
                    <h2 class="text-3xl font-serif font-bold text-forest-green mb-2 text-center dark:text-off-white" data-i18n="mindmap_generator_title">AI Mind Map Generator (Sankalpa View)</h2>
                    <p class="text-center text-deep-charcoal/70 mb-8 dark:text-off-white/70 max-w-2xl mx-auto" data-i18n="mindmap_generator_subtitle">Create a hierarchical Sankalpa (Intention/Concept) map instantly to visualize knowledge structure.</p>

                    <h3 class="2xl font-serif font-bold text-deep-charcoal mb-4 dark:text-off-white" data-i18n="mindmap_generate_map_title">Generate Sankalpa Map</h3>

                    <input type="text" id="mindmap-topic-input" data-i18n-placeholder="mindmap_topic_placeholder" placeholder="Enter central topic (e.g., Photosynthesis, The Four Noble Truths)" 
                        class="w-full p-3 mb-4 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white text-base">

                    <button id="generate-mindmap-btn" onclick="generateMindMap()" class="w-full bg-forest-green text-off-white font-bold py-3 rounded-full hover:bg-forest-green/90 transition duration-200 shadow-md" data-i18n="mindmap_generate_map_button">
                        Generate Mind Map
                    </button>

                    <div id="mindmap-loading" class="text-center mt-3 hidden text-forest-green dark:text-sage-green" data-i18n="mindmap_loading_text">
                        <span class="animate-pulse">Building Mind Map structure...</span>
                    </div>

                    <div class="mt-6 border-t border-sage-green/50 pt-4 dark:border-forest-green/50">
                        <h4 class="text-lg font-bold text-deep-charcoal dark:text-off-white mb-2" data-i18n="mindmap_view_title">Sankalpa View:</h4>
                        <!-- Mind Map Rendering Area -->
                        <div id="mindmap-output" class="p-3 min-h-[150px] border border-sage-green rounded-md text-sm dark:border-forest-green dark:bg-dark-bg-main/50 dark:text-off-white/90 flex flex-col items-center space-y-4" data-i18n="mindmap_output_placeholder">
                            The generated mind map structure will appear here.
                        </div>
                    </div>
                </div>
                <!-- End AI MIND MAP GENERATOR -->

                
                <!-- AI FLASHCARD SYNTHESIS (Smaranam Recall) - FULL WIDTH -->
<div class="max-w-4xl mx-auto bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-warm-gold dark:bg-dark-card-soft dark:border-warm-gold z-20">
                    <h2 class="text-3xl font-serif font-bold text-forest-green mb-2 text-center dark:text-off-white" data-i18n="flashcard_synthesis_title">AI Flashcard Synthesis (Smaranam Recall)</h2>
                    <p class="text-center text-deep-charcoal/70 mb-8 dark:text-off-white/70 max-w-2xl mx-auto" data-i18n="flashcard_synthesis_subtitle">Generate a personalized set of question-answer cards based on your desired topic and study intensity.</p>

                    <h3 class="2xl font-serif font-bold text-deep-charcoal mb-4 dark:text-off-white" data-i18n="flashcard_generate_study_set">Generate Study Set</h3>
                    
                    <!-- AI Generation Input with Count -->
                    <div class="space-y-3 mb-6">
                        <!-- Topic Input -->
                        <input type="text" id="flashcard-topic-input" data-i18n-placeholder="flashcard_topic_placeholder" placeholder="Enter topic for AI generation (e.g., Photosynthesis or The Vedas)" 
                            class="w-full p-3 mb-4 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white text-base">
                        
                        <!-- Count Input and Generate Button -->
                        <div class="flex space-x-4 items-center">
                            <label for="flashcard-count-input" class="text-sm font-bold text-deep-charcoal/70 dark:text-off-white/70 flex-shrink-0" data-i18n="flashcard_number_of_cards">Number of Cards:</label>
                            <input type="number" id="flashcard-count-input" value="5" min="1" max="20"
                                class="w-20 p-2 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white text-sm text-center">
                            
                            <button id="generate-cards-btn-dashboard" onclick="triggerFlashcardGeneration()" class="flex-grow bg-forest-green text-off-white font-bold py-2 rounded-full hover:bg-forest-green/90 transition duration-200 shadow-md" data-i18n="flashcard_generate_deck">
                                Generate New Study Deck
                            </button>
                        </div>
                    </div>
                    
                    <div id="card-loading" class="text-center text-forest-green dark:text-sage-green mb-4 hidden" data-i18n="flashcard_loading_text">
                        <span class="animate-pulse">Synthesizing Notebook Cards...</span>
                    </div>

                    <div id="flashcard-container" class="relative w-full h-64 perspective-1000 cursor-pointer" onclick="flipCard()">
                        <!-- Flashcard element -->
<div class="card-inner">
                            <div class="card-face card-front border border-warm-gold/50">
                                <span id="card-topic-context" class="text-xs text-forest-green/70 dark:text-off-white/50 absolute top-3 left-4" data-i18n="flashcard_context_initial">Topic: General Knowledge - Card 1 of 4</span>
                                <span id="card-front-text" class="font-bold text-xl dark:text-deep-charcoal" data-i18n="flashcard_front_initial">Tap or click 'Generate' to begin your Smaranam Recall session.</span>
                            </div>
                            <div class="card-face card-back border border-forest-green/50">
                                <span id="card-back-text" class="text-xl" data-i18n="flashcard_back_initial">This is where the detailed answer will appear after flipping the card.</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center space-x-4 mt-6">
                        <button onclick="nextCard(true)" class="bg-forest-green text-off-white font-bold py-2 px-6 rounded-full hover:bg-forest-green/80 transition duration-200 shadow-lg" data-i18n="flashcard_recall_ok">Recall OK (Next)</button>
                        <button onclick="nextCard(false)" class="bg-red-600 text-off-white font-bold py-2 px-6 rounded-full hover:bg-red-600/80 transition duration-200 shadow-lg" data-i18n="flashcard_review_later">Review Later</button>
                    </div>
                </div>
                <!-- End of AI Flashcard Synthesis area -->

                
                <!-- TEXT SUMMARIZER DASHBOARD (Vidyut Sara) - FULL WIDTH -->
<div class="max-w-4xl mx-auto bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-forest-green dark:bg-dark-card-soft dark:border-sage-green z-20">
                    <h2 class="text-3xl font-serif font-bold text-forest-green mb-2 text-center dark:text-off-white" data-i18n="summarizer_title">Text Summarizer (Vidyut Sara)</h2>
                    <p class="text-center text-deep-charcoal/70 mb-8 dark:text-off-white/70 max-w-2xl mx-auto" data-i18n="summarizer_subtitle">Quickly distill core knowledge from lengthy texts to enhance retention.</p>

                    <h3 class="2xl font-serif font-bold text-deep-charcoal mb-4 dark:text-off-white" data-i18n="summarizer_abstract_generator">Abstract Generator</h3>

                    <label for="summarizer-input" class="text-sm font-bold text-deep-charcoal/70 dark:text-off-white/70 block mb-2" data-i18n="summarizer_paste_text_label">Paste your text here (Min 100 characters):</label>
                    <textarea id="summarizer-input" rows="8" data-i18n-placeholder="summarizer_input_placeholder" placeholder="Paste your article, notes, or chapter summary here..." 
                        class="w-full p-3 mb-4 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white text-base"></textarea>

                    <button id="summarize-btn" onclick="triggerSummarizer()" class="w-full bg-warm-gold text-deep-charcoal font-bold py-3 rounded-full hover:bg-warm-gold/90 transition duration-200 shadow-md" data-i18n="summarizer_button">
                        Summarize Text (Generate Sara)
                    </button>

                    <div id="summarizer-loading" class="text-center mt-3 hidden text-forest-green dark:text-sage-green" data-i18n="summarizer_loading_text">
                        <span class="animate-pulse">Analyzing text depth...</span>
                    </div>

                    <div class="mt-6 border-t border-sage-green/50 pt-4 dark:border-forest-green/50">
                        <h4 class="text-lg font-bold text-deep-charcoal dark:text-off-white mb-2" data-i18n="summarizer_output_title">Generated Abstract:</h4>
                        <div id="summarizer-output" class="p-3 min-h-[100px] border border-sage-green rounded-md text-sm dark:border-forest-green dark:bg-dark-bg-main/50 dark:text-off-white/90" data-i18n="summarizer_output_placeholder_text">
                            The concise summary will appear here after analysis.
                        </div>
                    </div>
                </div>
                <!-- End TEXT SUMMARIZER DASHBOARD -->

                
                <!-- COLLABORATION / PEER MATCHING (Vidyut Mitra) - NEW FULL WIDTH SECTION -->
<div id="collaboration-functional-area" class="max-w-4xl mx-auto bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-warm-gold dark:bg-dark-card-soft dark:border-warm-gold z-20">
                    <h2 class="text-3xl font-serif font-bold text-deep-charcoal mb-2 text-center dark:text-off-white" data-i18n="peer_match_title">Vidyut Mitra (Peer Match)</h2>
                    <p class="text-center text-deep-charcoal/70 dark:text-off-white/80 text-sm mb-6" data-i18n="peer_match_subtitle">Find a study partner who is currently focused on a related topic in the communal study space.</p>
                    
                    <h3 class="2xl font-serif font-bold text-deep-charcoal mb-4 dark:text-off-white" data-i18n="peer_match_match_request">Request Peer Match</h3>

                    <!-- Match Topic Selector - Now an INPUT FIELD -->
                    <input type="text" id="peer-match-topic-input" 
                        data-i18n-placeholder="peer_match_topic_input_placeholder" 
                        placeholder="Enter your current study topic (e.g., Quantum Entanglement)" 
                        class="w-full p-3 mb-4 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white text-base">

                    <button id="find-mitra-btn" onclick="simulatePeerMatch()" class="w-full bg-forest-green text-off-white font-bold py-3 rounded-full hover:bg-forest-green/90 transition duration-200 shadow-md" data-i18n="peer_match_find_button">
                        Find My Vidyut Mitra
                    </button>
                    
                    <div id="match-loading" class="text-center mt-3 hidden text-forest-green dark:text-sage-green" data-i18n="peer_match_loading_text">
                        <span class="animate-pulse">Searching the community...</span>
                    </div>

                    <div id="match-output" class="mt-6 border-t border-sage-green/50 pt-4 dark:border-forest-green/50 p-3 min-h-[100px] border border-sage-green rounded-md text-sm dark:border-forest-green dark:bg-dark-bg-main/50 dark:text-off-white/90" data-i18n="peer_match_output_placeholder">
                        <!-- Match results appear here -->Type your topic and click the button to find someone studying the same thing!
                    </div>
                </div>
                <!-- End COLLABORATION / PEER MATCHING -->

                <!-- AI STORY TELLER (Functional Mockup - FULL WIDTH) -->
<div id="storyteller-functional-area" class="max-w-4xl mx-auto bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-forest-green dark:bg-dark-card-soft dark:border-forest-green z-20">
                    <h2 class="text-3xl font-serif font-bold text-deep-charcoal mb-2 text-center dark:text-off-white" data-i18n="storyteller_title">Convert Topic to Story (AI)</h2>
                    <p class="text-center text-deep-charcoal/70 dark:text-off-white/80 text-sm mb-6" data-i18n="storyteller_subtitle">Turn a complex concept into an engaging narrative (Rishi Vyasa's Tale) for powerful, emotional memory retention.</p>
                    
                    <input type="text" id="story-input" data-i18n-placeholder="storyteller_input_placeholder" placeholder="e.g., Photosynthesis or Dharana" 
                        class="w-full p-3 mb-4 border border-sage-green rounded-md focus:ring-warm-gold focus:border-warm-gold dark:bg-dark-bg-main dark:border-forest-green dark:text-off-white">
                    
                    <button id="generate-story-btn" onclick="generateStory()" class="w-full bg-warm-gold text-deep-charcoal font-bold py-3 rounded-full hover:bg-warm-gold/90 transition duration-200 shadow-md" data-i18n="storyteller_button">
                        Generate Story
                    </button>
                    
                    <div id="story-loading" class="text-center mt-3 hidden text-forest-green dark:text-sage-green" data-i18n="storyteller_loading_text">
                        <span class="animate-pulse">Generating Rishi Vyasa's tale...</span>
                    </div>

                    <div id="story-output" class="mt-6 border-t border-sage-green/50 pt-4 dark:border-forest-green/50 p-3 min-h-[100px] border border-sage-green rounded-md text-sm dark:border-forest-green dark:bg-dark-bg-main/50 dark:text-off-white/90" data-i18n="storyteller_output_placeholder">
                        <!-- Story output will appear here -->Type a topic and click generate to see the power of AI mnemonics.
                    </div>
                </div>
                <!-- End AI STORY TELLER -->
            </div>
        </section>

        <!-- 3. ABOUT PAGE -->
<section id="about-page" class="page-content hidden container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16 max-w-4xl relative z-10">
            <h2 class="4xl font-serif font-bold text-forest-green mb-10 text-center dark:text-warm-gold" data-i18n="about_title">Our Philosophy: Bridging Ancient Wisdom</h2>
            
            <div class="space-y-6 text-lg bg-off-white p-8 rounded-xl shadow-soft border-t-4 border-warm-gold dark:bg-dark-card-soft dark:border-warm-gold z-20">
                <p class="dark:text-off-white/90" data-i18n="about_p1">
                    Vidyutsetu is more than a study app‚Äîit's a <strong>bridge</strong> (<strong>Setu</strong>) connecting modern learners with profound ancient Indian knowledge systems. We seamlessly integrate powerful techniques like the <strong>Memory Palace</strong> (Loci method), <strong>chanting-based recall</strong> (<strong>Smaranam</strong>), and <strong>meditative concentration rituals</strong> (<strong>Dharana</strong>) with adaptive digital technology.
                </p>
                <p class="dark:text-off-white/90" data-i18n="about_p2">
                    Our core mission is to help students achieve <strong>deep, lasting understanding</strong>, moving beyond transient memorization for tests. We believe that disciplined focus, spatial memory, and meaningful repetition lead to truly strong, self-sustaining knowledge.
                </p>
                <p class="dark:text-off-white/90" data-i18n="about_p3">
                    By studying with intention and calm, you unlock the full potential of your mind. Join us in transforming how the world learns.
                </p>
            </div>
            
            <div class="mt-12 text-center">
                <p class="text-xl font-serif text-deep-charcoal/80 dark:text-off-white/80" data-i18n="about_quote">
                    "Knowledge is the fire that burns away the dross."
                </p>
            </div>
        </section>
    </main>

    <!-- Footer -->
<footer class="bg-sage-green mt-16 py-8 text-center text-deep-charcoal/70 font-sans text-sm dark:bg-dark-card-soft dark:text-off-white/70 relative z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            &copy; 2025 VIDYUTSETU. All rights reserved. | <span class="text-forest-green dark:text-warm-gold" data-i18n="footer_motto">Ancient Wisdom. Modern Tools.</span>
        </div>
    </footer>

    <script type="module">
        // --- Global Application State and Firebase Setup ---
        let app, db, auth;
        let userId = null;
        let isAuthReady = false;
        let studyRoomData = { compartments: [] };
        let currentDragElement = null;
        let dragOffsetX, dragOffsetY;
        let saveTimeout;
        
        // Pomodoro State
        let timerInterval = null;
        let totalSeconds = 25 * 60;
        let sessionType = 'Study Focus';
        let focusDuration = parseInt(localStorage.getItem('focusDuration') || '25', 10); // Custom focus duration in minutes
        const SHORT_BREAK = 5 * 60;  // 5 minutes
        let isRunning = false;
        let pomodorosCompleted = parseInt(localStorage.getItem('pomodorosCompleted') || '0', 10);
        let dailyTarget = parseInt(localStorage.getItem('dailyTarget') || '4', 10);
        
        // Lofi Audio State (Updated for YouTube Embed)
        const YOUTUBE_VIDEO_ID = 'Jvgx5HHJ0qw'; // Specific video ID
        let lofiIframe = null; 
        let isLofiPlaying = false; 
        let isLofiMuted = true; // Start muted due to browser policy

        // Falling Emojis State (NEW)
        const fallingEmojis = ['üçÇ', 'üåº'];
        let fallingInterval;

        // Flashcard State (Updated for dynamic content)
        const initialFlashcards = [
            { topic: "Vidyutsetu Concepts", front: "Welcome to your Dashboard!", back: "Use the AI Flashcard tool below to generate a study deck for any topic." },
            { topic: "Vidyutsetu Concepts", front: "Need to focus?", back: "Start the Dharana Focus Timer (Pomodoro) for deep work sessions." },
            { topic: "Vidyutsetu Concepts", front: "Memory Palace Tip:", back: "Visualize your concepts in your Study Room to build strong spatial links." },
            { topic: "Vidyutsetu Concepts", front: "Check your progress!", back: "View your streak and Pomodoro count in the metrics section above." },
        ];
        let dynamicFlashcards = initialFlashcards;
        let currentCardIndex = 0;

        // Mood State
        const moodEmojis = {
            Excellent: 'üòä',
            Good: 'üôÇ',
            Okay: 'üòê',
            Struggling: 'üòü',
            Exhausted: 'ü•µ',
            Tired: 'üò¥', // Added for the quick action
            Focused: 'üß†' // Added for the quick action
        };
        const moodColors = {
            Excellent: '#10B981', // Emerald 500
            Good: '#3B82F6',      // Blue 500
            Okay: '#F59E0B',      // Amber 500
            Struggling: '#F97316', // Orange 500
            Exhausted: '#EF4444', // Red 500
            Tired: '#6B7280',     // Gray 500
            Focused: '#D9B66A'    // Warm Gold
        };
        let selectedMood = 'Excellent'; // Default selected mood

        // Firestore Paths and IDs
        const STUDY_ROOM_COLLECTION = 'memory_palace';
        const STUDY_ROOM_DOC_ID = 'study_room_data';
        const MOOD_COLLECTION = 'mood_log';
        const GROUPS_COLLECTION = 'study_groups'; // Public Collection

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- MULTILINGUAL TRANSLATION DATA ---
        let currentLang = localStorage.getItem('language') || 'en';
        
        const translations = {
            en: {
                app_title: "VIDYUTSETU: Ancient Memory √ó Modern Learning",
                app_name: "VIDYUTSETU",
                app_name_full: "VIDYUTSETU",
                homepage_tagline: "Ancient Memory √ó Modern Learning.",
                homepage_explore_features: "Explore Features",
                homepage_mindful_path_title: "A Mindful Path to Mastery",
                homepage_mindful_path_text: "Vidyutsetu helps you forge unbreakable connections between knowledge and memory. We blend time-tested visualization techniques with a suite of digital tools designed for deep, focused, and joyful study.",
                homepage_see_full_features: "See Full Features",
                homepage_learners_say_title: "What Our Learners Say",
                testimonial_1_quote: `"The Virtual Study Room changed how I organize my thoughts. Placing concepts spatially made recalling complex material feel automatic and effortless. It‚Äôs truly a game-changer."`,
                testimonial_1_author: "‚Äî Anjali P., Medical Student",
                testimonial_2_quote: `"The focus lock is exactly what I needed. Combined with the mood tracker, I've seen massive improvements in my daily discipline and overall study consistency. Highly recommended."`,
                testimonial_2_author: "‚Äî Rohan S., Software Engineer",

                pillar_visualization_title: "Visualization",
                pillar_visualization_text: "The Virtual Study Room (Memory Palace) creates strong spatial memory links, turning your knowledge into a physical, navigable space.",
                pillar_repetition_title: "Repetition",
                pillar_repetition_text: "Smart flashcards using Spaced Repetition (SRS), active recall quizzes, and voice chants solidify knowledge retention over time.",
                pillar_immersion_title: "Immersion",
                pillar_immersion_text: "Dedicated Focus Mode, Pomodoro timers, distraction penalties, and streak tracking build study discipline and ritual.",

                nav_home: "Home",
                nav_study_room: "Study Room",
                nav_dashboard: "Dashboard",
                nav_features: "Features",
                nav_about: "About",
                nav_progress: "Progress", // NEW
                nav_groups: "Groups", // NEW
                
                auth_account_access: "Account Access",
                auth_status: "Status:",
                auth_email_placeholder: "Email (mock@example.example)",
                auth_password_placeholder: "Password (mock password)",
                auth_login: "Login",
                auth_signup: "Sign Up",
                auth_mock_signout: "Mock Sign Out",
                auth_signout_success: "Signed out. Signed in anonymously.",
                auth_enter_credentials: "Please enter mock email and password.",
                auth_login_success: "Mock Login Successful.",
                auth_signup_success: "Mock Sign Up Successful.",
                auth_login_fail: "Mock Login Failed. Check credentials or try again.",
                auth_signup_fail: "Mock Sign Up Failed. Check credentials or try again.",
                auth_status_authenticated: "Authenticated",
                auth_status_mock: "Mock User",
                auth_status_signed_out: "Signed Out (Anonymous)",

                walk_mode_title: "Smaranam Palace - 3D Walk Mode",
                walk_mode_subtitle: "Click the glowing anchors to recall your topics and notes.",
                walk_mode_exit: "Exit View",
                walk_mode_empty_prompt: "Your palace is empty. Add compartments in the Study Room first.",
                walk_mode_topic: "Topic:",
                walk_mode_items: "items",
                walk_mode_note: "Note",
                
                study_room_title: "Virtual Study Room (Smaranam Palace)",
                study_room_subtitle: "Drag and drop compartments and notes to build your spatial memory links. Your changes are auto-saved.",
                study_room_add_compartment: "+ Add Compartment (Topic)",
                study_room_add_note: "+ Add Note (Flashcard)",
                study_room_walk_mode: "Walk Mode (3D)",
                study_room_loading: "Loading your Study Room...",
                study_room_saving: "Saving...",
                study_room_login_prompt: "Sign in to load your personalized Study Room.",

                dashboard_welcome_back: "Welcome Back",
                dashboard_continue_journey: "Continue your mindful learning journey",
                tab_overview: "Overview",
                tab_study_rooms: "Study Rooms",
                tab_flashcards: "Flashcards",
                tab_focus: "Focus",
                tab_progress: "Progress",
                tab_groups: "Groups",
                metric_study_rooms: "Study Rooms",
                metric_create_room: "Create Room",
                metric_day_streak: "Day Streak",
                metric_start_focus: "Start Focus",
                metric_create_flashcard: "Create Flashcard",
                metric_manage_focus: "Manage Focus Settings", // UPDATED
                metric_flashcards: "Flashcards",
                quick_actions_title: "Quick Actions",
                quick_action_log_mood_title: "Log Mood",
                quick_action_log_mood_subtitle: "Track your emotional state post-session for better mindfulness.",
                quick_action_study_groups_title: "Study Groups",
                quick_action_study_groups_subtitle: "Collaborate with peers. (Now Functional!)",
                quick_action_join_group: "Browse Shared Topics",
                focus_details_title: "Focus Details & Settings",
                focus_session_duration: "Focus Session Duration (Mins):", // NEW
                focus_daily_target: "Daily Pomodoro Target (Units):",
                focus_today_progress: "Today's Completed Pomodoros:",
                focus_study_focus: "Study Focus",
                focus_short_break: "Short Break",
                focus_pause_study: "Pause Study",
                focus_pause_break: "Pause Break",
                focus_distraction_penalty: "Distraction Penalty - Timer Reset",

                mood_dashboard_title: "Mood Dashboard",
                mood_dashboard_subtitle: "Track your emotional and energy levels for mindful awareness",
                mood_how_feeling: "How are you feeling today?",
                mood_excellent: "Excellent",
                mood_good: "Good",
                mood_okay: "Okay",
                mood_struggling: "Struggling",
                mood_exhausted: "Exhausted",
                mood_energy_level: "Energy Level:",
                mood_energy_level_short: "Energy",
                mood_notes_title: "Notes (optional)",
                mood_notes_placeholder: "What's on your mind?",
                mood_log_entry: "Log Mood Entry",
                mood_recent_checkins: "Recent Check-ins",
                mood_no_checkins: "No mood check-ins yet.",

                groups_title: "Collaborative Study Topics", // NEW
                groups_subtitle: "Share and view topics with the wider Vidyutsetu community.", // NEW
                groups_input_placeholder: "Enter a shared study topic (e.g., Quantum Entanglement)", // NEW
                groups_add_topic: "Share Topic", // NEW
                groups_shared_list: "Shared Topics List", // NEW
                groups_no_topics: "No shared topics yet. Be the first to add one!", // NEW
                groups_add_success: "Topic shared successfully!",
                groups_input_error: "Please enter a topic with at least 5 characters.",
                groups_delete: "Delete",

                progress_title: "Learning Progress Summary", // NEW
                progress_subtitle: "Visualizing your Dharana (Focus) and Smaranam (Recall) efforts.", // NEW
                progress_streak_days: "Study Streak Days", // NEW
                progress_total_sessions: "Total Focus Sessions", // NEW
                progress_weekly_chart: "Weekly Focus Activity (Pomodoros)", // NEW
                
                // --- Mind Map Concepts (Updated to be NotebookLM-style/Generic) ---
                mindmap_core_components: "Core Entities",
                mindmap_concept_a: "Definition / Principles",
                mindmap_concept_b: "Key Terminology",
                mindmap_integration: "Structural Breakdown",
                mindmap_study_room: "Sub-Topic 1 (History)",
                mindmap_flashcards: "Sub-Topic 2 (Mechanisms)",
                mindmap_pomodoro: "Sub-Topic 3 (Key Figures)",
                mindmap_application: "Synthesis & Application",
                mindmap_active_recall: "Implications / Consequences",
                mindmap_long_term_retention: "Real-World Examples",
                
                peer_match_title: "Vidyut Mitra (Peer Match)", // NEW
                peer_match_subtitle: "Find a study partner who is currently focused on a related topic in the communal study space.", // NEW
                peer_match_match_request: "Request Peer Match", // NEW
                peer_match_find_button: "Find My Vidyut Mitra", // NEW
                peer_match_loading_text: "Searching the community...", // NEW
                peer_match_output_placeholder: "Type your topic and click the button to find someone studying the same thing!", // NEW (UPDATED)
                peer_match_found: "Match Found!", // NEW
                peer_match_no_match: "No peer currently available for this topic. Try again soon!", // NEW
                peer_match_join_chat: "Join Virtual Chat", // NEW
                peer_match_topic_input_placeholder: "Enter your current study topic (e.g., Quantum Entanglement)", // NEW
                feature_collaboration_peer_match_placeholder: "Find a Study Partner", // NEW

                // --- End Mind Map Concepts ---


                features_hub_title: "Interactive Feature Hub",
                feature_memory_palace_title: "Memory Palace (Loci)",
                feature_memory_palace_subtitle: "Spatial learning environment. **(GO TO STUDY ROOM)**",
                feature_focus_system_title: "Focus System (Dharana)",
                feature_focus_system_subtitle: "Pomodoro Timer, focus lock, and streak tracking. **(GO TO DASHBOARD)**",
                feature_mind_maps_title: "Mind Maps Builder",
                feature_mind_maps_generator_placeholder: "Sankalpa View Generator",
                feature_mind_maps_subtitle_2: "Visualize hierarchies and relationships between concepts.",
                feature_collaboration_title: "Collaboration",
                feature_collaboration_subtitle: "Shared rooms and study-mate matching are now live!",
                
                mindmap_generator_title: "AI Mind Map Generator (Sankalpa View)",
                mindmap_generator_subtitle: "Create a hierarchical Sankalpa (Intention/Concept) map instantly to visualize knowledge structure.",
                mindmap_generate_map_title: "Generate Sankalpa Map",
                mindmap_topic_placeholder: "Enter central topic (e.g., Photosynthesis, The Four Noble Truths)",
                mindmap_generate_map_button: "Generate Mind Map",
                mindmap_loading_text: "Building Mind Map structure...",
                mindmap_view_title: "Sankalpa View:",
                mindmap_output_placeholder: "The generated mind map structure will appear here.",
                mindmap_no_topic_error: "Please enter a topic to generate the map.",
                mindmap_analyzing: "Analyzing topic...",
                
                flashcard_synthesis_title: "AI Flashcard Synthesis (Smaranam Recall)",
                flashcard_synthesis_subtitle: "Generate a personalized set of question-answer cards based on your desired topic and study intensity.",
                flashcard_generate_study_set: "Generate Study Set",
                flashcard_topic_placeholder: "Enter topic for AI generation (e.g., Photosynthesis or The Vedas)",
                flashcard_number_of_cards: "Number of Cards:",
                flashcard_generate_deck: "Generate New Study Deck",
                flashcard_loading_text: "Synthesizing Notebook Cards...",
                flashcard_context_initial: "Topic: General Knowledge - Card 1 of 4",
                flashcard_front_initial: "Tap or click 'Generate' to begin your Smaranam Recall session.",
                flashcard_back_initial: "This is where the detailed answer will appear after flipping the card.",
                flashcard_recall_ok: "Recall OK (Next)",
                flashcard_review_later: "Review Later",
                flashcard_q: "Q:",
                flashcard_a: "A:",
                flashcard_card: "Card",
                flashcard_of: "of",
                flashcard_no_topic_error: "Please enter a topic or create a Study Room first.",
                flashcard_error: "Error",
                flashcard_generation_error: "Error generating cards. Try a simpler topic.",

                summarizer_title: "Text Summarizer (Vidyut Sara)",
                summarizer_subtitle: "Quickly distill core knowledge from lengthy texts to enhance retention.",
                summarizer_abstract_generator: "Abstract Generator",
                summarizer_paste_text_label: "Paste your text here (Min 100 characters):",
                summarizer_input_placeholder: "Paste your article, notes, or chapter summary here...",
                summarizer_button: "Summarize Text (Generate Sara)",
                summarizer_loading_text: "Analyzing text depth...",
                summarizer_output_title: "Generated Abstract:",
                summarizer_output_placeholder_text: "The concise summary will appear here after analysis.",
                summarizer_min_char_error: "Please enter at least 100 characters to generate a summary.",
                summarizer_abstract_prefix: "Vidyut Sara has condensed your input of",
                summarizer_word_text: "words into a core abstract.",
                summarizer_abstract_suffix: "Focusing on key terms and relationships dramatically aids memory retrieval.",
                summarizer_generating: "Generating Abstract...",

                storyteller_title: "Convert Topic to Story (AI)",
                storyteller_subtitle: "Turn a complex concept into an engaging narrative (Rishi Vyasa's Tale) for powerful, emotional memory retention.",
                storyteller_input_placeholder: "e.g., Photosynthesis or Dharana",
                storyteller_button: "Generate Story",
                storyteller_loading_text: "Generating Rishi Vyasa's tale...",
                storyteller_output_placeholder: "Type a topic and click generate to see the power of AI mnemonics.",
                storyteller_no_topic_error: "Please enter a topic to weave a story.",
                storyteller_connecting: "Connecting to Rishi Vyasa's narrative stream...",
                storyteller_mock_story: "Rishi Vyasa smiled knowingly. 'Ah, the tale of {prompt} is one of ancient light and shadow.' He narrated how the concept of {prompt} is like a seed, nurtured by focused intention and repetition. The core ideas are the roots, the sub-points the strong trunk, and the memorized details the leaves that capture the light of understanding. Always remember the journey of the seed, young learner.",
                storyteller_generation_error: "A cosmic fog descended. Error generating story.",

                about_title: "Our Philosophy: Bridging Ancient Wisdom",
                about_p1: "Vidyutsetu is more than a study app‚Äîit's a <strong>bridge</strong> (<strong>Setu</strong>) connecting modern learners with profound ancient Indian knowledge systems. We seamlessly integrate powerful techniques like the <strong>Memory Palace</strong> (Loci method), <strong>chanting-based recall</strong> (<strong>Smaranam</strong>), and <strong>meditative concentration rituals</strong> (<strong>Dharana</strong>) with adaptive digital technology.",
                about_p2: "Our core mission is to help students achieve <strong>deep, lasting understanding</strong>, moving beyond transient memorization for tests. We believe that disciplined focus, spatial memory, and meaningful repetition lead to truly strong, self-sustaining knowledge.",
                about_p3: "By studying with intention and calm, you unlock the full potential of your mind. Join us in transforming how the world learns.",
                about_quote: '"Knowledge is the fire that burns away the dross."',
                footer_motto: "Ancient Wisdom. Modern Tools.",
            },
            hi: {
                app_title: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§‡§∏‡•á‡§§‡•Å: ‡§™‡•ç‡§∞‡§æ‡§ö‡•Ä‡§® ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø √ó ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ",
                app_name: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§‡§∏‡•á‡§§‡•Å",
                app_name_full: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§‡§∏‡•á‡§§‡•Å",
                homepage_tagline: "‡§™‡•ç‡§∞‡§æ‡§ö‡•Ä‡§® ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø √ó ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ‡•§",
                homepage_explore_features: "‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Å ‡§¶‡•á‡§ñ‡•á‡§Ç",
                homepage_mindful_path_title: "‡§Æ‡§æ‡§á‡§Ç‡§°‡§´‡•Å‡§≤‡§®‡•á‡§∏ ‡§∏‡•á ‡§Æ‡§π‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§ì‡§∞",
                homepage_mindful_path_text: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§‡§∏‡•á‡§§‡•Å ‡§ú‡•ç‡§û‡§æ‡§® ‡§î‡§∞ ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§Ö‡§ü‡•Ç‡§ü ‡§∏‡§Ç‡§¨‡§Ç‡§ß ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§π‡§Æ ‡§ó‡§π‡§®, ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§î‡§∞ ‡§Ü‡§®‡§Ç‡§¶‡§Æ‡§Ø ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§è ‡§ó‡§è ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§â‡§™‡§ï‡§∞‡§£‡•ã‡§Ç ‡§ï‡•á ‡§∏‡•Ç‡§ü ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Æ‡§Ø-‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£‡§ø‡§§ ‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§® ‡§§‡§ï‡§®‡•Ä‡§ï‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§ø‡§≤‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§",
                homepage_see_full_features: "‡§∏‡§≠‡•Ä ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Å ‡§¶‡•á‡§ñ‡•á‡§Ç",
                homepage_learners_say_title: "‡§π‡§Æ‡§æ‡§∞‡•á ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ‡§∞‡•ç‡§•‡•Ä ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç",
                testimonial_1_quote: `"‡§µ‡§∞‡•ç‡§ö‡•Å‡§Ö‡§≤ ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§∞‡•Ç‡§Æ ‡§®‡•á ‡§Æ‡•á‡§∞‡•á ‡§µ‡§ø‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§§‡§∞‡•Ä‡§ï‡§æ ‡§¨‡§¶‡§≤ ‡§¶‡§ø‡§Ø‡§æ‡•§ ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∞‡§ñ‡§®‡•á ‡§∏‡•á ‡§ú‡§ü‡§ø‡§≤ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§Ø‡§æ‡§¶ ‡§ï‡§∞‡§®‡§æ ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§î‡§∞ ‡§∏‡§π‡§ú ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§π‡•Å‡§Ü‡•§ ‡§Ø‡§π ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§ó‡•á‡§Æ-‡§ö‡•á‡§Ç‡§ú‡§∞ ‡§π‡•à‡•§ "`,
                testimonial_1_author: "‚Äî ‡§Ö‡§Ç‡§ú‡§≤‡§ø ‡§™‡•Ä., ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§õ‡§æ‡§§‡•ç‡§∞",
                testimonial_2_quote: `"‡§´‡§º‡•ã‡§ï‡§∏ ‡§≤‡•â‡§ï ‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤ ‡§µ‡§π‡•Ä ‡§π‡•à ‡§ú‡§ø‡§∏‡§ï‡•Ä ‡§Æ‡•Å‡§ù‡•á ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§ ‡§•‡•Ä‡•§ ‡§Æ‡•Ç‡§° ‡§ü‡•ç‡§∞‡•à‡§ï‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡§ø‡§≤‡§ï‡§∞, ‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ö‡§™‡§®‡•Ä ‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§® ‡§î‡§∞ ‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§∏‡§Ç‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§¨‡§°‡§º‡•á ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§¶‡•á‡§ñ‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§‡•§"`,
                testimonial_2_author: "‚Äî ‡§∞‡•ã‡§π‡§® ‡§è‡§∏., ‡§∏‡•â‡§´‡•ç‡§ü‡§µ‡•á‡§Ø‡§∞ ‡§á‡§Ç‡§ú‡•Ä‡§®‡§ø‡§Ø‡§∞",

                pillar_visualization_title: "‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§®",
                pillar_visualization_text: "‡§µ‡§∞‡•ç‡§ö‡•Å‡§Ö‡§≤ ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§∞‡•Ç‡§Æ (‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§™‡•à‡§≤‡•á‡§∏) ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§≤‡§ø‡§Ç‡§ï ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à, ‡§Ü‡§™‡§ï‡•á ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§è‡§ï ‡§≠‡•å‡§§‡§ø‡§ï, ‡§®‡•å‡§ó‡§Æ‡•ç‡§Ø ‡§∏‡•ç‡§•‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§",
                pillar_repetition_title: "‡§™‡•Å‡§®‡§∞‡§æ‡§µ‡•É‡§§‡•ç‡§§‡§ø",
                pillar_repetition_text: "‡§∏‡•ç‡§™‡•á‡§∏‡§° ‡§∞‡§ø‡§™‡•Ä‡§ü‡§ø‡§∂‡§® (‡§è‡§∏‡§Ü‡§∞‡§è‡§∏), ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§∞‡§ø‡§ï‡•â‡§≤ ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§î‡§∞ ‡§Æ‡•Å‡§ñ‡§∞ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§´‡•ç‡§≤‡•à‡§∂‡§ï‡§æ‡§∞‡•ç‡§° ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡•ç‡§∞‡§§‡§ø‡§ß‡§æ‡§∞‡§£ ‡§ï‡•ã ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§",
                pillar_immersion_title: "‡§µ‡§ø‡§∏‡§∞‡•ç‡§ú‡§®",
                pillar_immersion_text: "‡§∏‡§Æ‡§∞‡•ç‡§™‡§ø‡§§ ‡§´‡•ã‡§ï‡§∏ ‡§Æ‡•ã‡§°, ‡§™‡•ã‡§Æ‡•ã‡§°‡•ã‡§∞‡•ã ‡§ü‡§æ‡§á‡§Æ‡§∞, ‡§µ‡•ç‡§Ø‡§æ‡§ï‡•Å‡§≤‡§§‡§æ ‡§¶‡§Ç‡§° ‡§î‡§∞ ‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ï ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§® ‡§î‡§∞ ‡§Ö‡§®‡•Å‡§∑‡•ç‡§†‡§æ‡§® ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§",

                nav_home: "‡§π‡•ã‡§Æ",
                nav_study_room: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§ï‡•ç‡§∑",
                nav_dashboard: "‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
                nav_features: "‡§µ‡§ø‡§∂‡•á‡§∑‡§§‡§æ‡§è‡§Ç",
                nav_about: "‡§π‡§Æ‡§æ‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç",
                nav_progress: "‡§™‡•ç‡§∞‡§ó‡§§‡§ø", // NEW
                nav_groups: "‡§∏‡§Æ‡•Ç‡§π", // NEW
                
                auth_account_access: "‡§ñ‡§æ‡§§‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏",
                auth_status: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø:",
                auth_email_placeholder: "‡§à‡§Æ‡•á‡§≤ (mock@example.com)",
                auth_password_placeholder: "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° (mock password)",
                auth_login: "‡§≤‡•â‡§ó ‡§á‡§®",
                auth_signup: "‡§∏‡§æ‡§á‡§® ‡§Ö‡§™",
                auth_mock_signout: "‡§Æ‡•â‡§ï ‡§∏‡§æ‡§á‡§® ‡§Ü‡§â‡§ü",
                auth_signout_success: "‡§∏‡§æ‡§á‡§® ‡§Ü‡§â‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§ ‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡§æ‡§á‡§® ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§",
                auth_enter_credentials: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡•â‡§ï ‡§à‡§Æ‡•á‡§≤ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",
                auth_login_success: "‡§Æ‡•â‡§ï ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§´‡§≤‡•§",
                auth_signup_success: "‡§Æ‡•â‡§ï ‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§∏‡§´‡§≤‡•§",
                auth_login_fail: "‡§Æ‡•â‡§ï ‡§≤‡•â‡§ó‡§ø‡§® ‡§µ‡§ø‡§´‡§≤‡•§ ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
                auth_signup_fail: "‡§Æ‡•â‡§ï ‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§µ‡§ø‡§´‡§≤‡•§ ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
                auth_status_authenticated: "‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§",
                auth_status_mock: "‡§Æ‡•â‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ",
                auth_status_signed_out: "‡§∏‡§æ‡§á‡§® ‡§Ü‡§â‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ (‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ)",

                walk_mode_title: "‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§™‡•à‡§≤‡•á‡§∏ - 3‡§°‡•Ä ‡§µ‡•â‡§ï ‡§Æ‡•ã‡§°",
                walk_mode_subtitle: "‡§Ö‡§™‡§®‡•á ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§ï‡•ã ‡§Ø‡§æ‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ö‡§Æ‡§ï‡§§‡•á ‡§è‡§Ç‡§ï‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                walk_mode_exit: "‡§¶‡•É‡§∂‡•ç‡§Ø ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡•á‡§Ç",
                walk_mode_empty_prompt: "‡§Ü‡§™‡§ï‡§æ ‡§Æ‡§π‡§≤ ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à‡•§ ‡§™‡§π‡§≤‡•á ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§ï‡•ç‡§∑ ‡§Æ‡•á‡§Ç ‡§°‡§ø‡§¨‡•ç‡§¨‡•á ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§",
                walk_mode_topic: "‡§µ‡§ø‡§∑‡§Ø:",
                walk_mode_items: "‡§Ü‡§á‡§ü‡§Æ",
                walk_mode_note: "‡§®‡•ã‡§ü",

                study_room_title: "‡§µ‡§∞‡•ç‡§ö‡•Å‡§Ö‡§≤ ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§∞‡•Ç‡§Æ (‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§™‡•à‡§≤‡•á‡§∏)",
                study_room_subtitle: "‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§≤‡§ø‡§Ç‡§ï ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§¨‡•ç‡§¨‡•ã‡§Ç ‡§î‡§∞ ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§ï‡•ã ‡§ñ‡•Ä‡§Ç‡§ö‡•á‡§Ç ‡§î‡§∞ ‡§õ‡•ã‡§°‡§º‡•á‡§Ç‡•§ ‡§Ü‡§™‡§ï‡•á ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§∏‡•ç‡§µ‡§§‡§É ‡§∏‡§π‡•á‡§ú‡•á ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§",
                study_room_add_compartment: "+ ‡§°‡§ø‡§¨‡•ç‡§¨‡•á ‡§ú‡•ã‡§°‡§º‡•á‡§Ç (‡§µ‡§ø‡§∑‡§Ø)",
                study_room_add_note: "+ ‡§®‡•ã‡§ü ‡§ú‡•ã‡§°‡§º‡•á‡§Ç (‡§´‡•ç‡§≤‡•à‡§∂‡§ï‡§æ‡§∞‡•ç‡§°)",
                study_room_walk_mode: "‡§µ‡•â‡§ï ‡§Æ‡•ã‡§° (3‡§°‡•Ä)",
                study_room_loading: "‡§Ü‡§™‡§ï‡§æ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§ï‡•ç‡§∑ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
                study_room_saving: "‡§∏‡§π‡•á‡§ú‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
                study_room_login_prompt: "‡§Ö‡§™‡§®‡§æ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§ï‡•ç‡§∑ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§æ‡§á‡§® ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç‡•§",

                dashboard_welcome_back: "‡§µ‡§æ‡§™‡§∏‡•Ä ‡§™‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à",
                dashboard_continue_journey: "‡§Ö‡§™‡§®‡•Ä ‡§Æ‡§æ‡§á‡§Ç‡§°‡§´‡•Å‡§≤ ‡§≤‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç",
                tab_overview: "‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®",
                tab_study_rooms: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§ï‡•ç‡§∑",
                tab_flashcards: "‡§´‡•ç‡§≤‡•à‡§∂‡§ï‡§æ‡§∞‡•ç‡§°",
                tab_focus: "‡§´‡•ã‡§ï‡§∏",
                tab_progress: "‡§™‡•ç‡§∞‡§ó‡§§‡§ø",
                tab_groups: "‡§∏‡§Æ‡•Ç‡§π",
                metric_study_rooms: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§ï‡•ç‡§∑",
                metric_create_room: "‡§ï‡§ï‡•ç‡§∑ ‡§¨‡§®‡§æ‡§è‡§Ç",
                metric_day_streak: "‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§≤‡§ï‡•Ä‡§∞",
                metric_start_focus: "‡§´‡•ã‡§ï‡§∏ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
                metric_create_flashcard: "‡§´‡•ç‡§≤‡•à‡§∂‡§ï‡§æ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç",
                metric_manage_focus: "‡§´‡•ã‡§ï‡§∏ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç", // UPDATED
                metric_flashcards: "‡§´‡•ç‡§≤‡•à‡§∂‡§ï‡§æ‡§∞‡•ç‡§°",
                quick_actions_title: "‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø",
                quick_action_log_mood_title: "‡§Æ‡•Ç‡§° ‡§≤‡•â‡§ó ‡§ï‡§∞‡•á‡§Ç",
                quick_action_log_mood_subtitle: "‡§¨‡•á‡§π‡§§‡§∞ ‡§Æ‡§æ‡§á‡§Ç‡§°‡§´‡•Å‡§≤‡§®‡•á‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§§‡•ç‡§∞ ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•ã ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                quick_action_study_groups_title: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§∏‡§Æ‡•Ç‡§π",
                quick_action_study_groups_subtitle: "‡§∏‡§π‡§ï‡§∞‡•ç‡§Æ‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ (‡§Ö‡§¨ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ï!)",
                quick_action_join_group: "‡§∏‡§æ‡§ù‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç",
                focus_details_title: "‡§´‡•ã‡§ï‡§∏ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§î‡§∞ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",
                focus_session_duration: "‡§´‡•ã‡§ï‡§∏ ‡§∏‡§§‡•ç‡§∞ ‡§Ö‡§µ‡§ß‡§ø (‡§Æ‡§ø‡§®‡§ü):", // NEW
                focus_daily_target: "‡§¶‡•à‡§®‡§ø‡§ï ‡§™‡•ã‡§Æ‡•ã‡§°‡•ã‡§∞‡•ã ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø (‡§á‡§ï‡§æ‡§á‡§Ø‡§æ‡§Å):",
                focus_today_progress: "‡§Ü‡§ú ‡§ï‡•á ‡§™‡•Ç‡§∞‡•á ‡§π‡•Å‡§è ‡§™‡•ã‡§Æ‡•ã‡§°‡•ã‡§∞‡•ã:",
                focus_study_focus: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§´‡•ã‡§ï‡§∏",
                focus_short_break: "‡§õ‡•ã‡§ü‡§æ ‡§¨‡•ç‡§∞‡•á‡§ï",
                focus_pause_study: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§∞‡•ã‡§ï‡•á‡§Ç",
                focus_pause_break: "‡§¨‡•ç‡§∞‡•á‡§ï ‡§∞‡•ã‡§ï‡•á‡§Ç",
                focus_distraction_penalty: "‡§µ‡•ç‡§Ø‡§æ‡§ï‡•Å‡§≤‡§§‡§æ ‡§¶‡§Ç‡§° - ‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§∞‡•Ä‡§∏‡•á‡§ü",

                mood_dashboard_title: "‡§Æ‡•Ç‡§° ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
                mood_dashboard_subtitle: "‡§Æ‡§æ‡§á‡§Ç‡§°‡§´‡•Å‡§≤ ‡§Ö‡§µ‡•á‡§Ø‡§∞‡§®‡•á‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§î‡§∞ ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§ï‡•á ‡§∏‡•ç‡§§‡§∞ ‡§ï‡•ã ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç",
                mood_how_feeling: "‡§Ü‡§ú ‡§Ü‡§™ ‡§ï‡•à‡§∏‡§æ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?",
                mood_excellent: "‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü",
                mood_good: "‡§Ö‡§ö‡•ç‡§õ‡§æ",
                mood_okay: "‡§†‡•Ä‡§ï ‡§π‡•à",
                mood_struggling: "‡§∏‡§Ç‡§ò‡§∞‡•ç‡§∑ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å",
                mood_exhausted: "‡§•‡§ï‡§æ ‡§π‡•Å‡§Ü",
                mood_energy_level: "‡§ä‡§∞‡•ç‡§ú‡§æ ‡§∏‡•ç‡§§‡§∞:",
                mood_energy_level_short: "‡§ä‡§∞‡•ç‡§ú‡§æ",
                mood_notes_title: "‡§®‡•ã‡§ü‡•ç‡§∏ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)",
                mood_notes_placeholder: "‡§Ü‡§™‡§ï‡•á ‡§Æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
                mood_log_entry: "‡§Æ‡•Ç‡§° ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§≤‡•â‡§ó ‡§ï‡§∞‡•á‡§Ç",
                mood_recent_checkins: "‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö-‡§™‡§°‡§º‡§§‡§æ‡§≤",
                mood_no_checkins: "‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§Æ‡•Ç‡§° ‡§ö‡•á‡§ï-‡§á‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü ‡§π‡•à‡•§",

                groups_title: "‡§∏‡§π‡§Ø‡•ã‡§ó‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§µ‡§ø‡§∑‡§Ø", // NEW
                groups_subtitle: "‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§‡§∏‡•á‡§§‡•Å ‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§µ‡§ø‡§∑‡§Ø ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§", // NEW
                groups_input_placeholder: "‡§è‡§ï ‡§∏‡§æ‡§ù‡§æ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á, ‡§ï‡•ç‡§µ‡§æ‡§Ç‡§ü‡§Æ ‡§â‡§≤‡§ù‡§æ‡§µ)", // NEW
                groups_add_topic: "‡§µ‡§ø‡§∑‡§Ø ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç", // NEW
                groups_shared_list: "‡§∏‡§æ‡§ù‡§æ ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä", // NEW
                groups_no_topics: "‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§∏‡§æ‡§ù‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§∏‡§¨‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§è‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç!", // NEW
                groups_add_success: "‡§µ‡§ø‡§∑‡§Ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
                groups_input_error: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 5 ‡§µ‡§∞‡•ç‡§£‡•ã‡§Ç ‡§µ‡§æ‡§≤‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",
                groups_delete: "‡§π‡§ü‡§æ‡§è‡§Å",

                progress_title: "‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂", // NEW
                progress_subtitle: "‡§Ü‡§™‡§ï‡•á ‡§ß‡§æ‡§∞‡§£‡§æ (‡§´‡•ã‡§ï‡§∏) ‡§î‡§∞ ‡§∏‡•ç‡§Æ‡§∞‡§£ (‡§∞‡§ø‡§ï‡•â‡§≤) ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ‡•§", // NEW
                progress_streak_days: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡•Ä ‡§≤‡§ï‡•Ä‡§∞ ‡§ï‡•á ‡§¶‡§ø‡§®", // NEW
                progress_total_sessions: "‡§ï‡•Å‡§≤ ‡§´‡•ã‡§ï‡§∏ ‡§∏‡§§‡•ç‡§∞", // NEW
                progress_weekly_chart: "‡§∏‡§æ‡§™‡•ç‡§§‡§æ‡§π‡§ø‡§ï ‡§´‡•ã‡§ï‡§∏ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø (‡§™‡•ã‡§Æ‡•ã‡§°‡•ã‡§∞‡•ã)", // NEW

                // --- Mind Map Concepts (Updated to be NotebookLM-style/Generic) ---
                mindmap_core_components: "‡§Æ‡•Ç‡§≤ ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§è‡§Ç",
                mindmap_concept_a: "‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§æ / ‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§Ç‡§§",
                mindmap_concept_b: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∂‡§¨‡•ç‡§¶‡§æ‡§µ‡§≤‡•Ä",
                mindmap_integration: "‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§ü‡•Ç‡§ü‡§®‡§æ",
                mindmap_study_room: "‡§â‡§™-‡§µ‡§ø‡§∑‡§Ø 1 (‡§á‡§§‡§ø‡§π‡§æ‡§∏)",
                mindmap_flashcards: "‡§â‡§™-‡§µ‡§ø‡§∑‡§Ø 2 (‡§§‡§Ç‡§§‡•ç‡§∞)",
                mindmap_pomodoro: "‡§â‡§™-‡§µ‡§ø‡§∑‡§Ø 3 (‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§π‡§∏‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç)",
                mindmap_application: "‡§∏‡§Ç‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§î‡§∞ ‡§Ö‡§®‡•Å‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó",
                mindmap_active_recall: "‡§®‡§ø‡§π‡§ø‡§§‡§æ‡§∞‡•ç‡§• / ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ",
                mindmap_long_term_retention: "‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§â‡§¶‡§æ‡§π‡§∞‡§£",

                peer_match_title: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§Æ‡§ø‡§§‡•ç‡§∞ (‡§™‡•Ä‡§Ø‡§∞ ‡§Æ‡•à‡§ö)", // NEW
                peer_match_subtitle: "‡§è‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≠‡§æ‡§ó‡•Ä‡§¶‡§æ‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç ‡§ú‡•ã ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§∏‡§æ‡§Ç‡§™‡•ç‡§∞‡§¶‡§æ‡§Ø‡§ø‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§∏‡•ç‡§•‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§µ‡§ø‡§∑‡§Ø ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•ã‡•§", // NEW
                peer_match_match_request: "‡§™‡•Ä‡§Ø‡§∞ ‡§Æ‡•à‡§ö ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§∞‡•á‡§Ç", // NEW
                peer_match_find_button: "‡§Æ‡•á‡§∞‡§æ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§Æ‡§ø‡§§‡•ç‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç", // NEW
                peer_match_loading_text: "‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø ‡§Æ‡•á‡§Ç ‡§ñ‡•ã‡§ú ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...", // NEW
                peer_match_output_placeholder: "‡§Ö‡§™‡§®‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§â‡§∏‡•Ä ‡§ö‡•Ä‡§ú‡§º ‡§ï‡§æ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç!", // NEW (UPDATED)
                peer_match_found: "‡§Æ‡•à‡§ö ‡§Æ‡§ø‡§≤ ‡§ó‡§Ø‡§æ!", // NEW
                peer_match_no_match: "‡§á‡§∏ ‡§µ‡§ø‡§∑‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§∏‡§π‡§ï‡§∞‡•ç‡§Æ‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç!", // NEW
                peer_match_join_chat: "‡§µ‡§∞‡•ç‡§ö‡•Å‡§Ö‡§≤ ‡§ö‡•à‡§ü ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç", // NEW
                peer_match_topic_input_placeholder: "‡§Ö‡§™‡§®‡§æ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á, ‡§ï‡•ç‡§µ‡§æ‡§Ç‡§ü‡§Æ ‡§â‡§≤‡§ù‡§æ‡§µ)", // NEW
                feature_collaboration_peer_match_placeholder: "‡§è‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≠‡§æ‡§ó‡•Ä‡§¶‡§æ‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç", // NEW

                // --- End Mind Map Concepts ---

                features_hub_title: "‡§á‡§Ç‡§ü‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§µ ‡§´‡•Ä‡§ö‡§∞ ‡§π‡§¨",
                feature_memory_palace_title: "‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§™‡•à‡§≤‡•á‡§∏ (‡§≤‡•ã‡§ï‡•Ä)",
                feature_memory_palace_subtitle: "‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£‡•§ **(‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§ï‡•ç‡§∑ ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç)**",
                feature_focus_system_title: "‡§´‡•ã‡§ï‡§∏ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ (‡§ß‡§æ‡§∞‡§£‡§æ)",
                feature_focus_system_subtitle: "‡§™‡•ã‡§Æ‡•ã‡§°‡•ã‡§∞‡•ã ‡§ü‡§æ‡§á‡§Æ‡§∞, ‡§´‡•ã‡§ï‡§∏ ‡§≤‡•â‡§ï ‡§î‡§∞ ‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ï ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó‡•§ **(‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç)**",
                feature_mind_maps_title: "‡§Æ‡§æ‡§á‡§Ç‡§° ‡§Æ‡•à‡§™‡•ç‡§∏ ‡§¨‡§ø‡§≤‡•ç‡§°‡§∞",
                feature_mind_maps_generator_placeholder: "‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™ ‡§¶‡•É‡§∂‡•ç‡§Ø ‡§ú‡§®‡§∞‡•á‡§ü‡§∞",
                feature_mind_maps_subtitle_2: "‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§™‡§¶‡§æ‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ ‡§î‡§∞ ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§",
                feature_collaboration_title: "‡§∏‡§π‡§Ø‡•ã‡§ó",
                feature_collaboration_subtitle: "‡§∏‡§æ‡§ù‡§æ ‡§ï‡§Æ‡§∞‡•á ‡§î‡§∞ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§®-‡§∏‡§æ‡§•‡•Ä ‡§Æ‡§ø‡§≤‡§æ‡§® ‡§Ö‡§¨ ‡§≤‡§æ‡§á‡§µ ‡§π‡•à‡§Ç!",
                
                mindmap_generator_title: "‡§è‡§Ü‡§à ‡§Æ‡§æ‡§á‡§Ç‡§° ‡§Æ‡•à‡§™ ‡§ú‡§®‡§∞‡•á‡§ü‡§∞ (‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™ ‡§¶‡•É‡§∂‡•ç‡§Ø)",
                mindmap_generator_subtitle: "‡§ú‡•ç‡§û‡§æ‡§® ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ ‡§ï‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§è‡§ï ‡§™‡§¶‡§æ‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§ø‡§§ ‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™ (‡§á‡§∞‡§æ‡§¶‡§æ/‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ) ‡§®‡§ï‡•ç‡§∂‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç‡•§",
                mindmap_generate_map_title: "‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™ ‡§®‡§ï‡•ç‡§∂‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç",
                mindmap_topic_placeholder: "‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡•Ä‡§Ø ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á, ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§∏‡§Ç‡§∂‡•ç‡§≤‡•á‡§∑‡§£, ‡§ö‡§æ‡§∞ ‡§Ü‡§∞‡•ç‡§Ø ‡§∏‡§§‡•ç‡§Ø)",
                mindmap_generate_map_button: "‡§Æ‡§æ‡§á‡§Ç‡§° ‡§Æ‡•à‡§™ ‡§¨‡§®‡§æ‡§è‡§Ç",
                mindmap_loading_text: "‡§Æ‡§æ‡§á‡§Ç‡§° ‡§Æ‡•à‡§™ ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
                mindmap_view_title: "‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™ ‡§¶‡•É‡§∂‡•ç‡§Ø:",
                mindmap_output_placeholder: "‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à ‡§Æ‡§æ‡§á‡§Ç‡§° ‡§Æ‡•à‡§™ ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ ‡§Ø‡§π‡§æ‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡•Ä‡•§",
                mindmap_no_topic_error: "‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",
                mindmap_analyzing: "‡§µ‡§ø‡§∑‡§Ø ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
                
                flashcard_synthesis_title: "‡§è‡§Ü‡§à ‡§´‡•ç‡§≤‡•à‡§∂‡§ï‡§æ‡§∞‡•ç‡§° ‡§∏‡§Ç‡§∂‡•ç‡§≤‡•á‡§∑‡§£ (‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§∞‡§ø‡§ï‡•â‡§≤)",
                flashcard_synthesis_subtitle: "‡§Ö‡§™‡§®‡•á ‡§µ‡§æ‡§Ç‡§õ‡§ø‡§§ ‡§µ‡§ø‡§∑‡§Ø ‡§î‡§∞ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡•Ä ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®-‡§â‡§§‡•ç‡§§‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡§æ ‡§è‡§ï ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§∏‡•á‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç‡•§",
                flashcard_generate_study_set: "‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§∏‡•á‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç",
                flashcard_topic_placeholder: "‡§è‡§Ü‡§à ‡§ú‡§®‡§∞‡•á‡§∂‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á, ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§∏‡§Ç‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Ø‡§æ ‡§µ‡•á‡§¶)",
                flashcard_number_of_cards: "‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ:",
                flashcard_generate_deck: "‡§®‡§Ø‡§æ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§°‡•á‡§ï ‡§¨‡§®‡§æ‡§è‡§Ç",
                flashcard_loading_text: "‡§®‡•ã‡§ü‡§¨‡•Å‡§ï ‡§ï‡§æ‡§∞‡•ç‡§° ‡§∏‡§Ç‡§∂‡•ç‡§≤‡•á‡§∑‡§ø‡§§ ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...",
                flashcard_context_initial: "‡§µ‡§ø‡§∑‡§Ø: ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ú‡•ç‡§û‡§æ‡§® - ‡§ï‡§æ‡§∞‡•ç‡§° 1 ‡§ï‡§æ 4",
                flashcard_front_initial: "‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§∞‡§ø‡§ï‡•â‡§≤ ‡§∏‡§§‡•ç‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è '‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç' ‡§™‡§∞ ‡§ü‡•à‡§™ ‡§Ø‡§æ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                flashcard_back_initial: "‡§ï‡§æ‡§∞‡•ç‡§° ‡§™‡§≤‡§ü‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§Ø‡§π‡§æ‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡§æ‡•§",
                flashcard_recall_ok: "‡§∞‡§ø‡§ï‡•â‡§≤ ‡§†‡•Ä‡§ï ‡§π‡•à (‡§Ö‡§ó‡§≤‡§æ)",
                flashcard_review_later: "‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç",
                flashcard_q: "Q:",
                flashcard_a: "A:",
                flashcard_card: "‡§ï‡§æ‡§∞‡•ç‡§°",
                flashcard_of: "‡§ï‡§æ",
                flashcard_no_topic_error: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§è‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§ï‡•ç‡§∑ ‡§¨‡§®‡§æ‡§è‡§Ç‡•§",
                flashcard_error: "‡§§‡•ç‡§∞‡•Å‡§ü‡§ø",
                flashcard_generation_error: "‡§ï‡§æ‡§∞‡•ç‡§° ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§è‡§ï ‡§∏‡§∞‡§≤ ‡§µ‡§ø‡§∑‡§Ø ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",

                summarizer_title: "‡§™‡§æ‡§† ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂‡§ï‡§∞‡•ç‡§§‡§æ (‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§∏‡§æ‡§∞)",
                summarizer_subtitle: "‡§™‡•ç‡§∞‡§§‡§ø‡§ß‡§æ‡§∞‡§£ ‡§¨‡§¢‡§º‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§Ç‡§¨‡•á ‡§ó‡•ç‡§∞‡§Ç‡§•‡•ã‡§Ç ‡§∏‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§∏‡•á ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç‡•§",
                summarizer_abstract_generator: "‡§∏‡§æ‡§∞ ‡§ú‡§®‡§∞‡•á‡§ü‡§∞",
                summarizer_paste_text_label: "‡§Ö‡§™‡§®‡§æ ‡§™‡§æ‡§† ‡§Ø‡§π‡§æ‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ 100 ‡§µ‡§∞‡•ç‡§£):",
                summarizer_input_placeholder: "‡§Ö‡§™‡§®‡§æ ‡§≤‡•á‡§ñ, ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§Ø‡§æ ‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§Ø ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§Ø‡§π‡§æ‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç...",
                summarizer_button: "‡§™‡§æ‡§† ‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§ï‡§∞‡•á‡§Ç (‡§∏‡§æ‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç)",
                summarizer_loading_text: "‡§™‡§æ‡§† ‡§ï‡•Ä ‡§ó‡§π‡§∞‡§æ‡§à ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
                summarizer_output_title: "‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§∏‡§æ‡§∞:",
                summarizer_output_placeholder_text: "‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§Ø‡§π‡§æ‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡§æ‡•§",
                summarizer_min_char_error: "‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 100 ‡§µ‡§∞‡•ç‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",
                summarizer_abstract_prefix: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§∏‡§æ‡§∞ ‡§®‡•á ‡§Ü‡§™‡§ï‡•á ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•ã",
                summarizer_word_text: "‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§ï‡•á ‡§è‡§ï ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ò‡§®‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à‡•§",
                summarizer_abstract_suffix: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§î‡§∞ ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•ã‡§Ç ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§™‡•Å‡§®‡§∞‡•ç‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§®‡§æ‡§ü‡§ï‡•Ä‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§Æ‡§ø‡§≤‡§§‡•Ä ‡§π‡•à‡•§",
                summarizer_generating: "‡§∏‡§æ‡§∞ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",

                storyteller_title: "‡§µ‡§ø‡§∑‡§Ø ‡§ï‡•ã ‡§ï‡§π‡§æ‡§®‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç (‡§è‡§Ü‡§à)",
                storyteller_subtitle: "‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä, ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§™‡•ç‡§∞‡§§‡§ø‡§ß‡§æ‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§ú‡§ü‡§ø‡§≤ ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ ‡§ï‡•ã ‡§è‡§ï ‡§Ü‡§ï‡§∞‡•ç‡§∑‡§ï ‡§ï‡§•‡§æ (‡§ã‡§∑‡§ø ‡§µ‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡•Ä ‡§ï‡§π‡§æ‡§®‡•Ä) ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç‡•§",
                storyteller_input_placeholder: "‡§ú‡•à‡§∏‡•á, ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§∏‡§Ç‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Ø‡§æ ‡§ß‡§æ‡§∞‡§£‡§æ",
                storyteller_button: "‡§ï‡§π‡§æ‡§®‡•Ä ‡§¨‡§®‡§æ‡§è‡§Ç",
                storyteller_loading_text: "‡§ã‡§∑‡§ø ‡§µ‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡•Ä ‡§ï‡§π‡§æ‡§®‡•Ä ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...",
                storyteller_output_placeholder: "‡§è‡§Ü‡§à ‡§∏‡•ç‡§Æ‡§∞‡§ï ‡§ï‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡§ø‡§∑‡§Ø ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ '‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                storyteller_no_topic_error: "‡§ï‡§π‡§æ‡§®‡•Ä ‡§¨‡•Å‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",
                storyteller_connecting: "‡§ã‡§∑‡§ø ‡§µ‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡•Ä ‡§ï‡§•‡§æ ‡§ß‡§æ‡§∞‡§æ ‡§∏‡•á ‡§ú‡•Å‡§°‡§º ‡§∞‡§π‡§æ ‡§π‡•à...",
                storyteller_mock_story: "‡§ã‡§∑‡§ø ‡§µ‡•ç‡§Ø‡§æ‡§∏ ‡§®‡•á ‡§ú‡§æ‡§®‡§ï‡§∞ ‡§Æ‡•Å‡§∏‡•ç‡§ï‡•Å‡§∞‡§æ‡§Ø‡§æ‡•§ '‡§Ü‡§π, {prompt} ‡§ï‡•Ä ‡§ï‡§π‡§æ‡§®‡•Ä ‡§™‡•ç‡§∞‡§æ‡§ö‡•Ä‡§® ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§î‡§∞ ‡§õ‡§æ‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§è‡§ï ‡§π‡•à‡•§' ‡§â‡§®‡•ç‡§π‡•ã‡§Ç‡§®‡•á ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ï‡§ø {prompt} ‡§ï‡•Ä ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ ‡§ï‡•à‡§∏‡•á ‡§è‡§ï ‡§¨‡•Ä‡§ú ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§π‡•à, ‡§ú‡§ø‡§∏‡•á ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§á‡§∞‡§æ‡§¶‡•á ‡§î‡§∞ ‡§™‡•Å‡§®‡§∞‡§æ‡§µ‡•É‡§§‡•ç‡§§‡§ø ‡§∏‡•á ‡§™‡•ã‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ú‡§°‡§º‡•á‡§Ç ‡§π‡•à‡§Ç, ‡§â‡§™-‡§¨‡§ø‡§Ç‡§¶‡•Å ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§§‡§®‡§æ ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§Ø‡§æ‡§¶ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§Æ‡§ù ‡§ï‡•á ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§ï‡•ã ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§™‡§§‡•ç‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§π‡§Æ‡•á‡§∂‡§æ ‡§¨‡•Ä‡§ú ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡•á‡§Ç, ‡§Ø‡•Å‡§µ‡§æ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ‡§∞‡•ç‡§•‡•Ä‡•§",
                storyteller_generation_error: "‡§è‡§ï ‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§æ‡§Ç‡§°‡•Ä‡§Ø ‡§ï‡•ã‡§π‡§∞‡§æ ‡§õ‡§æ ‡§ó‡§Ø‡§æ‡•§ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§",

                about_title: "‡§π‡§Æ‡§æ‡§∞‡§æ ‡§¶‡§∞‡•ç‡§∂‡§®: ‡§™‡•ç‡§∞‡§æ‡§ö‡•Ä‡§® ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º‡§®‡§æ",
                about_p1: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§‡§∏‡•á‡§§‡•Å ‡§è‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ê‡§™ ‡§∏‡•á ‡§ï‡§π‡•Ä‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à‚Äî‡§Ø‡§π ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ‡§∞‡•ç‡§•‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§ó‡§π‡§® ‡§™‡•ç‡§∞‡§æ‡§ö‡•Ä‡§® ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§è‡§ï <strong>‡§™‡•Å‡§≤</strong> (<strong>‡§∏‡•á‡§§‡•Å</strong>) ‡§π‡•à‡•§ ‡§π‡§Æ ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡•Ä ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡•á ‡§∏‡§æ‡§• <strong>‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§™‡•à‡§≤‡•á‡§∏</strong> (‡§≤‡•ã‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø), <strong>‡§Æ‡§Ç‡§§‡•ç‡§∞-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∞‡§ø‡§ï‡•â‡§≤</strong> (<strong>‡§∏‡•ç‡§Æ‡§∞‡§£</strong>), ‡§î‡§∞ <strong>‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§è‡§ï‡§æ‡§ó‡•ç‡§∞‡§§‡§æ ‡§Ö‡§®‡•Å‡§∑‡•ç‡§†‡§æ‡§®‡•ã‡§Ç</strong> (<strong>‡§ß‡§æ‡§∞‡§£‡§æ</strong>) ‡§ú‡•à‡§∏‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§§‡§ï‡§®‡•Ä‡§ï‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§π‡§ú‡§§‡§æ ‡§∏‡•á ‡§è‡§ï‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§",
                about_p2: "‡§π‡§Æ‡§æ‡§∞‡§æ ‡§Æ‡•Ç‡§≤ ‡§Æ‡§ø‡§∂‡§® ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§∑‡§£‡§ø‡§ï ‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡§®‡•á ‡§∏‡•á ‡§™‡§∞‡•á, <strong>‡§ó‡§π‡§®, ‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∏‡§Æ‡§ù</strong> ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡§æ ‡§π‡•à‡•§ ‡§π‡§Æ ‡§Æ‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§ø‡§§ ‡§´‡•ã‡§ï‡§∏, ‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§î‡§∞ ‡§∏‡§æ‡§∞‡•ç‡§•‡§ï ‡§™‡•Å‡§®‡§∞‡§æ‡§µ‡•É‡§§‡•ç‡§§‡§ø ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§Æ‡§ú‡§¨‡•Ç‡§§, ‡§Ü‡§§‡•ç‡§Æ-‡§ü‡§ø‡§ï‡§æ‡§ä ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•Ä ‡§ì‡§∞ ‡§≤‡•á ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§",
                about_p3: "‡§á‡§∞‡§æ‡§¶‡•á ‡§î‡§∞ ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§∞‡§ï‡•á, ‡§Ü‡§™ ‡§Ö‡§™‡§®‡•á ‡§Æ‡§® ‡§ï‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã ‡§Ö‡§®‡§≤‡•â‡§ï ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§ú‡•â‡§á‡§® ‡§Ö‡§∏ ‡§á‡§® ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§∏‡§´‡•â‡§∞‡•ç‡§Æ‡§ø‡§Ç‡§ó ‡§π‡§æ‡§â ‡§¶ ‡§µ‡§∞‡•ç‡§≤‡•ç‡§° ‡§≤‡§∞‡•ç‡§®‡§∏‡•§",
                about_quote: '"‡§ú‡•ç‡§û‡§æ‡§® ‡§µ‡§π ‡§Ü‡§ó ‡§π‡•à ‡§ú‡•ã ‡§Æ‡•à‡§≤ ‡§ï‡•ã ‡§ú‡§≤‡§æ ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§"',
                footer_motto: "‡§™‡•ç‡§∞‡§æ‡§ö‡•Ä‡§® ‡§ú‡•ç‡§û‡§æ‡§®‡•§ ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§â‡§™‡§ï‡§∞‡§£‡•§",
            }
        };

        // --- CORE MULTILINGUAL FUNCTIONS ---

        function translateElement(element, lang) {
            const key = element.dataset.i18n;
            const placeholderKey = element.dataset.i18nPlaceholder;
            const translation = translations[lang];

            if (translation && key) {
                const text = translation[key];
                if (text !== undefined) {
                    // Handle special HTML content (like the bold tags in the about section)
                    if (key.startsWith('about_p')) {
                        element.innerHTML = text;
                    } else {
                        element.textContent = text;
                    }
                }
            }
            if (translation && placeholderKey) {
                const placeholderText = translation[placeholderKey];
                if (placeholderText !== undefined) {
                    element.setAttribute('placeholder', placeholderText);
                }
            }
        }

        function translateUI(lang) {
            // Update document title
            const titleElement = document.querySelector('title');
            translateElement(titleElement, lang);
            
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => translateElement(el, lang));
            
            // Update input placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => translateElement(el, lang));
            
            // Sync current language to HTML tag
            document.documentElement.lang = lang;
            
            // Re-render components that rely on specific translated text (like mood or study rooms)
            if (dynamicFlashcards.length > 0) {
                 renderFlashcard();
            }
            renderStudyGroups();
            renderRecentMoodCheckins(); // Also re-render check-ins for translated mood names
        }

        window.switchLanguage = (lang) => {
            if (translations[lang]) {
                currentLang = lang;
                localStorage.setItem('language', lang);
                document.getElementById('lang-selector').value = lang; // Sync dropdown
                translateUI(lang);
            }
        };

        // --- Utility Functions ---
        
        /** Generates a simple, unique ID. */
        function generateId() {
            return Math.random().toString(36).substring(2, 9);
        }

        /** Shows a loading message for the study room. */
        function setLoadingMessage(message, isError = false) {
            const loadingMsg = document.getElementById('loading-data-message');
            if (loadingMsg) {
                loadingMsg.textContent = message;
                loadingMsg.classList.toggle('text-red-600', isError);
                loadingMsg.classList.toggle('dark:text-red-400', isError);
                loadingMsg.classList.remove('hidden');
            }
        }

        /** Hides the study room loading message. */
        function hideLoadingMessage() {
            const loadingMsg = document.getElementById('loading-data-message');
            if (loadingMsg) loadingMsg.classList.add('hidden');
        }

        /**
         * Debounced function to save the application state to Firestore.
         */
        function debounceSaveState() {
            clearTimeout(saveTimeout);
            const indicator = document.getElementById('loading-indicator');
            if (indicator) indicator.classList.remove('hidden');

            saveTimeout = setTimeout(async () => {
                await saveStudyRoomState();
                if (indicator) indicator.classList.add('hidden');
            }, 1000);
        }

        // --- Firebase Core Functions ---
        
        /** Updates the mock auth modal UI with current Firebase status. */
        function updateAuthUI() {
            const statusText = document.getElementById('auth-status-text');
            const uidText = document.getElementById('auth-uid-text');
            const authForm = document.getElementById('auth-form');

            if (!statusText || !uidText || !authForm) return;

            if (userId) {
                statusText.textContent = userId.length > 20 ? (translations[currentLang].auth_status_authenticated || 'Authenticated') : (translations[currentLang].auth_status_mock || 'Mock User');
                uidText.textContent = userId;
                authForm.classList.add('hidden');
            } else {
                statusText.textContent = translations[currentLang].auth_status_signed_out || 'Signed Out (Anonymous)';
                uidText.textContent = 'None';
                authForm.classList.remove('hidden');
                // Clear inputs on mock sign out (no translation needed here)
                const emailInput = document.getElementById('auth-email');
                const passwordInput = document.getElementById('auth-password');
                if (emailInput) emailInput.value = '';
                if (passwordInput) passwordInput.value = '';
            }
        }
        
        /** Mock authentication handler. */
        window.mockAuth = (action) => {
            const messageEl = document.getElementById('auth-message');
            if (!messageEl) return;
            
            messageEl.textContent = '';
            
            if (action === 'signout') {
                userId = null;
                initializeFirebaseAndAuth(true); // Restart auth to sign in anonymously
                messageEl.textContent = translations[currentLang].auth_signout_success;
                return;
            }
            
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            if (!email || !password) {
                messageEl.textContent = translations[currentLang].auth_enter_credentials;
                return;
            }

            if (email.includes('@') && password.length >= 6) {
                messageEl.textContent = translations[currentLang][`auth_${action}_success`];
                userId = `mockUser-${generateId()}`; 
                updateAuthUI();
                startStudyRoomListener(); 
                startGroupsListener();
                toggleAuthModal(false);
            } else {
                messageEl.textContent = translations[currentLang][`auth_${action}_fail`];
            }
        }
        
        /** Toggles the visibility of the authentication modal. */
        window.toggleAuthModal = (show) => {
            const modal = document.getElementById('auth-modal');
            if (modal) {
                modal.classList.toggle('hidden', !show);
                if (show) updateAuthUI();
                const messageEl = document.getElementById('auth-message');
                if (messageEl) messageEl.textContent = '';
            }
        }

        async function initializeFirebaseAndAuth(restarting = false) {
            try {
                if (!app || restarting) {
                    app = firebase.initializeApp(firebaseConfig);
                    db = firebase.getFirestore(app);
                    auth = firebase.getAuth(app);
                    firebase.setLogLevel('Debug'); 
                }

                if (initialAuthToken) {
                    await firebase.signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await firebase.signInAnonymously(auth);
                }

                firebase.onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        console.log("User authenticated. UID:", userId);
                        startStudyRoomListener();
                        startGroupsListener(); // Start public listener
                    } else {
                        userId = null;
                        isAuthReady = true;
                        setLoadingMessage(translations[currentLang].study_room_login_prompt);
                    }
                    updateAuthUI();
                });

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
                setLoadingMessage(`Authentication Error: ${error.message}`, true);
                updateAuthUI();
            }
        }
        
        function getStudyRoomDocRef() {
            if (!db || !userId) return null;
            // Private user collection path
            const collectionPath = `artifacts/${appId}/users/${userId}/${STUDY_ROOM_COLLECTION}`;
            return firebase.doc(db, collectionPath, STUDY_ROOM_DOC_ID);
        }

        function getGroupsCollectionRef() {
            if (!db) return null;
            // Public collection path
            const collectionPath = `artifacts/${appId}/public/data/${GROUPS_COLLECTION}`;
            return firebase.collection(db, collectionPath);
        }

        function startStudyRoomListener() {
            const docRef = getStudyRoomDocRef();
            if (!docRef) return;

            firebase.onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    studyRoomData = docSnap.data();
                } else {
                    studyRoomData = { compartments: [] };
                    saveStudyRoomState(true); 
                }
                renderPalaceCanvas();
                hideLoadingMessage();
                initializeDashboardMetrics();
            }, (error) => {
                console.error("Error listening to Firestore (Study Room):", error);
                setLoadingMessage(`Failed to load data: ${error.message}`, true);
            });
        }

        let sharedTopics = [];
        
        function startGroupsListener() {
            const colRef = getGroupsCollectionRef();
            if (!colRef) return;
            
            const groupsLoading = document.getElementById('groups-loading');
            if (groupsLoading) groupsLoading.classList.remove('hidden');

            // Listen for changes in the public groups collection
            firebase.onSnapshot(colRef, (snapshot) => {
                sharedTopics = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    sharedTopics.push({
                        id: doc.id,
                        topicName: data.topicName,
                        userId: data.userId,
                        timestamp: data.timestamp ? new Date(data.timestamp.toDate()) : null
                    });
                });
                // Sort by newest first
                sharedTopics.sort((a, b) => (b.timestamp?.getTime() || 0) - (a.timestamp?.getTime() || 0));

                renderStudyGroups();
                if (groupsLoading) groupsLoading.classList.add('hidden');
            }, (error) => {
                console.error("Error listening to Firestore (Groups):", error);
                const groupsList = document.getElementById('shared-topics-list');
                if (groupsList) groupsList.innerHTML = `<p class="text-red-600 dark:text-red-400">Error loading shared topics: ${error.message}</p>`;
                if (groupsLoading) groupsLoading.classList.add('hidden');
            });
        }

        async function saveStudyRoomState(initial = false) {
            if (!isAuthReady || !userId) {
                return;
            }
            const docRef = getStudyRoomDocRef();
            if (!docRef) return;

            try {
                await firebase.setDoc(docRef, studyRoomData);
            } catch (error) {
                console.error("Error saving Study Room state:", error);
            }
        }

        // --- Memory Palace Core Logic (Unchanged) ---
        
        function renderPalaceCanvas() { 
            const canvas = document.getElementById('palace-canvas');
            if (!canvas) return;
            canvas.querySelectorAll('.compartment, .note-card').forEach(e => e.remove());

            studyRoomData.compartments.forEach(comp => {
                const compEl = createCompartmentElement(comp);
                canvas.appendChild(compEl);

                const noteContainer = compEl.querySelector('[data-notecontainer]');
                comp.notes.forEach(note => {
                    const noteEl = createNoteElement(note, comp.id);
                    noteContainer.appendChild(noteEl);
                });
            });
            setupDragListeners();
        }
        
        function createCompartmentElement(comp) { 
            const compEl = document.createElement('div');
            compEl.id = `comp-${comp.id}`;
            compEl.dataset.id = comp.id;
            compEl.dataset.type = 'compartment';
            compEl.className = `compartment bg-sage-green rounded-lg p-3 shadow-lg border border-forest-green/50 dark:bg-dark-card-soft dark:border-warm-gold/50`;
            compEl.style.left = `${comp.x}px`;
            compEl.style.top = `${comp.y}px`;
            compEl.style.zIndex = 10;
            compEl.style.position = 'absolute';

            const header = document.createElement('div');
            header.className = 'font-serif text-lg font-bold text-deep-charcoal mb-2 dark:text-off-white';
            header.textContent = comp.name || (currentLang === 'hi' ? "‡§®‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø" : "New Topic");
            header.contentEditable = true;
            header.onblur = (e) => {
                const sanitizedText = e.target.textContent.replace(/[$\*]/g, '').trim(); 
                comp.name = sanitizedText || (currentLang === 'hi' ? "‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡§∞‡§π‡§ø‡§§ ‡§µ‡§ø‡§∑‡§Ø" : "Untitled Topic");
                e.target.textContent = comp.name;
                debounceSaveState();
            };
            compEl.appendChild(header);
            
            const noteContainer = document.createElement('div');
            noteContainer.dataset.notecontainer = comp.id;
            noteContainer.className = 'flex flex-wrap gap-2 p-1';
            compEl.appendChild(noteContainer);

            const deleteBtn = document.createElement('button');
            deleteBtn.innerHTML = '&#x2715;'; 
            deleteBtn.className = 'absolute top-1 right-1 text-deep-charcoal/50 hover:text-red-600 transition duration-100 p-1 rounded-full dark:text-off-white/50';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                removeCompartment(comp.id);
            };
            compEl.appendChild(deleteBtn);

            return compEl;
        }
        
        function createNoteElement(note, parentCompId) { 
              const noteEl = document.createElement('div');
            noteEl.id = `note-${note.id}`;
            noteEl.dataset.id = note.id;
            noteEl.dataset.type = 'note';
            noteEl.dataset.parent = parentCompId;
            noteEl.className = `note-card bg-off-white rounded-md shadow-md border-t-2 border-warm-gold text-sm p-2 text-deep-charcoal relative dark:bg-dark-bg-main dark:text-off-white dark:border-warm-gold`;
            
            const content = document.createElement('div');
            content.className = 'w-full h-full overflow-hidden';
            content.textContent = note.content || (currentLang === 'hi' ? "‡§∏‡§æ‡§Æ‡§®‡•á | ‡§™‡•Ä‡§õ‡•á" : "Front | Back");
            content.contentEditable = true;
            content.onblur = (e) => {
                const comp = studyRoomData.compartments.find(c => c.id === parentCompId);
                const sanitizedText = e.target.textContent.replace(/[$\*]/g, '').trim(); 
                
                if (comp) {
                    const n = comp.notes.find(note => note.id === noteEl.dataset.id);
                    if (n) n.content = sanitizedText;
                }
                e.target.textContent = sanitizedText;
                debounceSaveState();
            };
            noteEl.appendChild(content);
            
            const deleteBtn = document.createElement('button');
            deleteBtn.innerHTML = '&#x2715;'; 
            deleteBtn.className = 'absolute top-0 right-0 text-deep-charcoal/50 hover:text-red-600 transition duration-100 p-1 rounded-full dark:text-off-white/50';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                removeNote(note.id, parentCompId);
            };
            noteEl.appendChild(deleteBtn);

            return noteEl;
        }

        function addCompartment() { 
            const newComp = {
                id: generateId(),
                name: (currentLang === 'hi' ? "‡§®‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø" : "New Topic"),
                x: 50 + Math.random() * 100,
                y: 50 + Math.random() * 100,
                notes: []
            };
            studyRoomData.compartments.push(newComp);
            renderPalaceCanvas();
            debounceSaveState();
        }

        function removeCompartment(id) { 
            studyRoomData.compartments = studyRoomData.compartments.filter(c => c.id !== id);
            renderPalaceCanvas();
            debounceSaveState();
        }

        function addNote() { 
            let targetComp = studyRoomData.compartments[0];
            
            if (!targetComp) {
                addCompartment();
                targetComp = studyRoomData.compartments[0];
                if (!targetComp) return;
            }

            const newNote = {
                id: generateId(),
                content: (currentLang === 'hi' ? "‡§∏‡§æ‡§Æ‡§®‡•á | ‡§™‡•Ä‡§õ‡•á" : "Front | Back")
            };
            targetComp.notes.push(newNote);
            renderPalaceCanvas();
            debounceSaveState();
        }
        
        function removeNote(noteId, compId) { 
            const comp = studyRoomData.compartments.find(c => c.id === compId);
            if (comp) {
                comp.notes = comp.notes.filter(n => n.id !== noteId);
                renderPalaceCanvas();
                debounceSaveState();
            }
        }
        
        function setupDragListeners() { 
            const canvas = document.getElementById('palace-canvas');
            if (!canvas) return;

            canvas.querySelectorAll(`[data-type="compartment"]`).forEach(el => {
                el.addEventListener('mousedown', startDrag);
                el.addEventListener('touchstart', startDrag);
            });
            
            canvas.querySelectorAll(`[data-type="note"]`).forEach(el => {
                el.removeEventListener('mousedown', startDrag);
                el.removeEventListener('touchstart', startDrag);
            });


            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }

        function startDrag(e) { 
            const element = e.currentTarget;
            currentDragElement = element;
            
            if (e.type === 'mousedown') e.preventDefault();

            let clientX, clientY;
            if (e.touches) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const rect = element.getBoundingClientRect();
            dragOffsetX = clientX - rect.left;
            dragOffsetY = clientY - rect.top;

            element.style.zIndex = 100;
        }

        function drag(e) { 
            if (!currentDragElement) return;
            if (currentDragElement.dataset.type !== 'compartment') return;

            let clientX, clientY;
            if (e.touches) {
                e.preventDefault(); 
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const canvasRect = document.getElementById('palace-canvas').getBoundingClientRect();

            let newX = clientX - canvasRect.left - dragOffsetX;
            let newY = clientY - canvasRect.top - dragOffsetY;

            newX = Math.max(0, Math.min(newX, canvasRect.width - currentDragElement.offsetWidth));
            newY = Math.max(0, Math.min(newY, canvasRect.height - currentDragElement.offsetHeight));
            
            currentDragElement.style.left = `${newX}px`;
            currentDragElement.style.top = `${newY}px`;
        }

        function endDrag(e) { 
            if (!currentDragElement) return;

            const id = currentDragElement.dataset.id;
            const type = currentDragElement.dataset.type;
            
            const finalX = parseFloat(currentDragElement.style.left);
            const finalY = parseFloat(currentDragElement.style.top);

            if (type === 'compartment') {
                const comp = studyRoomData.compartments.find(c => c.id === id);
                if (comp) {
                    comp.x = finalX;
                    comp.y = finalY;
                }
            } 

            currentDragElement.style.zIndex = 10;
            currentDragElement = null;
            debounceSaveState();
        }

        // --- 3D Walk Mode Logic (NEW HEAVY FEATURE) ---
        
        window.toggle3DMode = (show) => {
            const modal = document.getElementById('walk-mode-modal');
            if (modal) {
                if (show) {
                    render3DView();
                    modal.classList.remove('hidden');
                    // Force reflow and add 'show' class for CSS transition
                    void modal.offsetWidth; 
                    modal.classList.add('show');
                } else {
                    modal.classList.remove('show');
                    setTimeout(() => modal.classList.add('hidden'), 500);
                }
            }
        }
        
        function render3DView() {
            const container = document.getElementById('walk-mode-anchors');
            const palaceCanvas = document.getElementById('palace-canvas');
            const recallDisplay = document.getElementById('recall-display');
            container.innerHTML = '';
            
            if (studyRoomData.compartments.length === 0) {
                container.innerHTML = `<p class="text-xl text-off-white/80">${translations[currentLang].walk_mode_empty_prompt}</p>`;
                return;
            }

            const canvasWidth = palaceCanvas.offsetWidth;
            const canvasHeight = palaceCanvas.offsetHeight;
            
            studyRoomData.compartments.forEach(comp => {
                const mockZ = comp.y / canvasHeight; 
                
                const compAnchor = document.createElement('div');
                compAnchor.className = `walk-anchor text-warm-gold text-2xl font-serif font-bold animate-pulse`;
                compAnchor.textContent = comp.name;
                compAnchor.style.left = `${comp.x / canvasWidth * 60 + 20}%`;
                compAnchor.style.top = `${mockZ * 60 + 20}%`;
                compAnchor.style.fontSize = `${3 - (mockZ * 1.5)}rem`;
                compAnchor.onclick = () => showRecall(comp.name, `${translations[currentLang].walk_mode_topic}: ${comp.notes.length} ${translations[currentLang].walk_mode_items}`);
                container.appendChild(compAnchor);

                comp.notes.forEach((note, index) => {
                    const noteAnchor = document.createElement('div');
                    noteAnchor.className = `walk-anchor text-off-white text-sm`;
                    noteAnchor.textContent = `[${translations[currentLang].walk_mode_note} ${index + 1}]`;
                    
                    const offsetX = (index % 2 === 0 ? 1 : -1) * (1 + Math.random() * 5); 
                    const offsetY = (index % 3 === 0 ? 1 : -1) * (1 + Math.random() * 5);
                    
                    noteAnchor.style.left = `calc(${compAnchor.style.left} + ${offsetX}vw)`;
                    noteAnchor.style.top = `calc(${compAnchor.style.top} + ${offsetY}vh)`;
                    noteAnchor.onclick = () => showRecall(comp.name, note.content);
                    container.appendChild(noteAnchor);
                });
            });
            
            function showRecall(title, content) {
                recallDisplay.innerHTML = `<p class="font-bold text-lg">${title}</p><p class="mt-1 text-sm italic">${content}</p>`;
                recallDisplay.style.opacity = 1;
                recallDisplay.style.transform = 'translateY(0)';
                
                setTimeout(() => {
                    recallDisplay.style.opacity = 0;
                    recallDisplay.style.transform = 'translateY(100%)';
                }, 4000); 
            }
        }
        
        // --- Pomodoro Timer Logic ---

        function formatTime(totalSeconds) { 
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function initializeDashboardMetrics() {
            const studyRoomCountEl = document.getElementById('study-room-count-display');
            const flashcardCountEl = document.getElementById('flashcard-count-display');
            const streakCounterEl = document.getElementById('streak-counter');
            const progressStreakEl = document.getElementById('progress-streak-display');
            const progressPomodorosTodayEl = document.getElementById('progress-pomodoros-today');
            
            if (studyRoomCountEl) {
                studyRoomCountEl.textContent = studyRoomData.compartments.length.toString();
            }
            if (flashcardCountEl) {
                const totalNotes = studyRoomData.compartments.reduce((sum, comp) => sum + comp.notes.length, 0);
                flashcardCountEl.textContent = totalNotes.toString();
            }
            
            // Sync Pomodoro/Streak data
            const currentStreak = localStorage.getItem('studyStreak') || '0';
            const totalSessions = localStorage.getItem('totalFocusSessions') || '12'; // Mock baseline total
            
            if (streakCounterEl) streakCounterEl.textContent = currentStreak; 
            if (progressStreakEl) progressStreakEl.textContent = currentStreak; 
            if (progressPomodorosTodayEl) progressPomodorosTodayEl.textContent = pomodorosCompleted.toString();
            if (document.getElementById('progress-total-sessions-display')) document.getElementById('progress-total-sessions-display').textContent = totalSessions;


            renderRecentMoodCheckins();
            renderWeeklyChart();
        }

        function updateDisplay() { 
            const timerEl = document.getElementById('pomodoro-timer');
            const statusEl = document.getElementById('pomodoro-status');
            const progressEl = document.getElementById('target-progress');
            const startBtnEl = document.getElementById('pomodoro-start');
            const targetInputEl = document.getElementById('daily-pomodoros-target');
            const durationInputEl = document.getElementById('focus-duration-input');
            
            // Retrieve translations for dynamic elements
            const statusTextKey = sessionType === 'Study Focus' ? 'focus_study_focus' : 'focus_short_break';
            const buttonTextKey = isRunning ? (sessionType === 'Study Focus' ? 'focus_pause_study' : 'focus_pause_break') : 'metric_start_focus';
            
            if (timerEl) timerEl.textContent = formatTime(totalSeconds);
            if (statusEl) statusEl.textContent = translations[currentLang][statusTextKey] || sessionType;
            if (progressEl) progressEl.textContent = `${pomodorosCompleted} / ${dailyTarget}`;
            
            if (startBtnEl) {
                startBtnEl.textContent = translations[currentLang][buttonTextKey] || 'Start Focus';
                if (isRunning) {
                    startBtnEl.classList.add('bg-red-600', 'hover:bg-red-700');
                    startBtnEl.classList.remove('bg-forest-green', 'hover:bg-forest-green/90');
                } else {
                    startBtnEl.classList.remove('bg-red-600', 'hover:bg-red-700');
                    startBtnEl.classList.add('bg-forest-green', 'hover:bg-forest-green/90');
                }
                // Disable duration and target inputs while running
                if(targetInputEl) targetInputEl.disabled = isRunning;
                if(durationInputEl) durationInputEl.disabled = isRunning;
            }

            if(targetInputEl) targetInputEl.value = dailyTarget;
            if(durationInputEl) durationInputEl.value = focusDuration;
            
            initializeDashboardMetrics();
        }
        
        function handleTick() { 
            totalSeconds--;
            updateDisplay();

            if (totalSeconds <= 0) {
                clearInterval(timerInterval);
                isRunning = false;
                
                if (sessionType === 'Study Focus') {
                    sessionType = 'Short Break';
                    totalSeconds = SHORT_BREAK;
                    
                    // Update Pomodoro Count
                    pomodorosCompleted++;
                    localStorage.setItem('pomodorosCompleted', pomodorosCompleted);

                    // Update Streak (simple increment, real SRS/streak logic is complex)
                    const currentStreak = parseInt(localStorage.getItem('studyStreak') || '0', 10);
                    localStorage.setItem('studyStreak', currentStreak + 1);

                    // Update Total Sessions
                    const totalSessions = parseInt(localStorage.getItem('totalFocusSessions') || '12', 10);
                    localStorage.setItem('totalFocusSessions', totalSessions + 1);

                } else {
                    sessionType = 'Study Focus';
                    totalSeconds = focusDuration * 60; // Use focusDuration
                }
                
                updateDisplay();
                setTimeout(() => startTimer(), 1000); 
            }
        }

        function startTimer() { 
            if (isRunning) return;
            // Set initial time based on duration setting if starting a new focus period
            if (sessionType === 'Study Focus' && totalSeconds === 0) {
                 totalSeconds = focusDuration * 60;
            }
            isRunning = true;
            updateDisplay();
            timerInterval = setInterval(handleTick, 1000);
        }

        function pauseTimer() { 
            if (!isRunning) return;
            clearInterval(timerInterval);
            isRunning = false;
            updateDisplay();
        }
        
        function resetTimer() { 
            pauseTimer();
            sessionType = 'Study Focus';
            totalSeconds = focusDuration * 60; // Use current focusDuration
            updateDisplay();
        }

        window.toggleTimer = () => { 
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }
        
        function checkVisibility() { 
            if (document.hidden && isRunning) {
                console.log("Tab switch detected. Distraction penalty applied: Timer reset.");
                resetTimer();
                const statusEl = document.getElementById('pomodoro-status');
                const distractionText = translations[currentLang].focus_distraction_penalty || "Distraction Penalty - Timer Reset";
                if (statusEl) statusEl.textContent = distractionText;
            }
        }

        window.setDailyTarget = (value) => {
            let newTarget = parseInt(value, 10);
            if (isNaN(newTarget) || newTarget < 1) newTarget = 1;
            if (newTarget > 20) newTarget = 20;

            dailyTarget = newTarget;
            localStorage.setItem('dailyTarget', dailyTarget);
            
            document.querySelectorAll('#daily-pomodoros-target').forEach(input => input.value = dailyTarget);
            
            updateDisplay();
        }

        window.setFocusDuration = (value) => {
            let newDuration = parseInt(value, 10);
            if (isNaN(newDuration) || newDuration < 5) newDuration = 5;
            if (newDuration > 60) newDuration = 60;

            focusDuration = newDuration;
            localStorage.setItem('focusDuration', focusDuration);
            
            // Only reset timer display if not running and we are setting the study phase
            if (!isRunning && sessionType === 'Study Focus') {
                totalSeconds = focusDuration * 60;
                updateDisplay();
            }
             if(document.getElementById('focus-duration-input')) document.getElementById('focus-duration-input').value = newDuration;
        }

        
        // --- Dark Mode Logic (Unchanged) ---

        function initializeDarkMode() {
            const toggle = document.getElementById('dark-mode-toggle');
            const html = document.documentElement;
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');

            const themePreference = localStorage.getItem('theme');
            let shouldBeDark = (themePreference === 'dark' || themePreference === null); 

            if (shouldBeDark) {
                html.classList.add('dark');
                sunIcon.classList.add('hidden'); 
                moonIcon.classList.remove('hidden');
            } else {
                html.classList.remove('dark');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }

            toggle.addEventListener('click', () => {
                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                } else {
                    html.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                }
            });
        }
        
        // --- Flashcard Logic (Unchanged) ---
        
        function renderFlashcard() {
            const card = dynamicFlashcards[currentCardIndex];
            if (!card) return;

            const cardCountText = `${translations[currentLang].flashcard_card || 'Card'} ${currentCardIndex + 1} ${translations[currentLang].flashcard_of || 'of'} ${dynamicFlashcards.length}`;

            document.getElementById('card-front-text').innerHTML = card.front;
            document.getElementById('card-back-text').innerHTML = card.back;
            document.getElementById('card-topic-context').textContent = `${translations[currentLang].flashcard_topic || 'Topic'}: ${card.topic} - ${cardCountText}`;
            document.getElementById('flashcard-container').classList.remove('is-flipped');
        }

        window.flipCard = () => {
            document.getElementById('flashcard-container').classList.toggle('is-flipped');
        }

        window.nextCard = (recalled) => {
            currentCardIndex = (currentCardIndex + 1) % dynamicFlashcards.length;
            renderFlashcard();
        }

        window.triggerFlashcardGeneration = () => {
            const topic = document.getElementById('flashcard-topic-input').value.trim();
            const countInput = document.getElementById('flashcard-count-input').value;
            let cardCount = parseInt(countInput, 10);
            
            if (isNaN(cardCount) || cardCount < 1) cardCount = 5;
            if (cardCount > 20) cardCount = 20;
            
            document.getElementById('flashcard-count-input').value = cardCount; 

            if (!topic) {
                if (studyRoomData.compartments.length > 0) {
                    generateFlashcards(studyRoomData.compartments[0].name, cardCount);
                } else {
                    const container = document.getElementById('flashcard-container');
                    container.querySelector('#card-front-text').textContent = translations[currentLang].flashcard_no_topic_error;
                    container.querySelector('#card-topic-context').textContent = `${translations[currentLang].flashcard_topic}: ${translations[currentLang].flashcard_error}`;
                }
                return;
            }
            generateFlashcards(topic, cardCount);
        }

        // --- LLM API Mock for Flashcard Generation (Unchanged) ---
        async function generateFlashcards(topic, cardCount) {
            const loadingEl = document.getElementById('card-loading');
            const generateBtn = document.getElementById('generate-cards-btn-dashboard');
            const cardContainer = document.getElementById('flashcard-container');
            
            generateBtn.disabled = true;
            generateBtn.textContent = translations[currentLang].flashcard_loading_text;
            loadingEl.classList.remove('hidden');
            cardContainer.classList.add('opacity-50');

            let generatedCards = [];
            try {
                for(let i = 0; i < cardCount; i++) {
                    generatedCards.push({
                        topic: topic,
                        front: `${translations[currentLang].flashcard_q || 'Q:'} ${i+1}: What is the primary concept of ${topic} in a deep learning context?`,
                        back: `${translations[currentLang].flashcard_a || 'A:'} ${i+1}: The main purpose is to build neural pathways that link ${topic} concepts to spatial memory for improved retrieval.`
                    });
                }
                
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                dynamicFlashcards = generatedCards;
                currentCardIndex = 0;
                renderFlashcard();

            } catch (error) {
                console.error("AI Generation Error:", error);
                const container = document.getElementById('flashcard-container');
                container.querySelector('#card-front-text').textContent = translations[currentLang].flashcard_generation_error;
                container.querySelector('#card-topic-context').textContent = `${translations[currentLang].flashcard_topic}: ${translations[currentLang].flashcard_error}`;
            } finally {
                loadingEl.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.textContent = translations[currentLang].flashcard_generate_deck;
                cardContainer.classList.remove('opacity-50');
            }
        }

        // --- TEXT SUMMARIZER Mock Logic (Vidyut Sara) (Unchanged) ---

        window.triggerSummarizer = () => {
            const inputEl = document.getElementById('summarizer-input');
            const text = inputEl.value.trim();

            if (text.length < 100) {
                document.getElementById('summarizer-output').textContent = translations[currentLang].summarizer_min_char_error;
                return;
            }
            summarizeText(text);
        }

        async function summarizeText(text) {
            const outputEl = document.getElementById('summarizer-output');
            const loadingEl = document.getElementById('summarizer-loading');
            const summarizeBtn = document.getElementById('summarize-btn');
            
            summarizeBtn.disabled = true;
            summarizeBtn.textContent = translations[currentLang].summarizer_generating;
            loadingEl.classList.remove('hidden');
            outputEl.textContent = '';
            
            const wordCount = text.split(/\s+/).length;
            const mockSummary = `${translations[currentLang].summarizer_abstract_prefix} ${wordCount} ${translations[currentLang].summarizer_word_text}. ${translations[currentLang].summarizer_abstract_suffix}`;

            await new Promise(resolve => setTimeout(resolve, 2500)); 
            
            outputEl.textContent = mockSummary;

            loadingEl.classList.add('hidden');
            summarizeBtn.disabled = false;
            summarizeBtn.textContent = translations[currentLang].summarizer_button;
        }
        
        // --- Mind Map Logic (UPDATED FOR NOTEBOOKLM STYLE MOCK) ---

        /**
         * Hardcoded general structure that allows the root node to be dynamically named
         * by the user input, mimicking how NotebookLM would classify concepts.
         * Note: The placeholder text uses simple Unicode/HTML entities instead of LaTeX.
         */
        const getMindMapData = (rootTopic) => ({
            root: rootTopic,
            children: [
                {
                    name: translations[currentLang].mindmap_core_components,
                    children: [
                        { name: translations[currentLang].mindmap_concept_a }, // e.g., Definition / Principles
                        { name: translations[currentLang].mindmap_concept_b }, // e.g., Key Terminology
                        { name: `Dependencies (Input) e.g., H‚ÇÇO` }, // Generic Scientific/Technical placeholder
                    ]
                },
                {
                    name: translations[currentLang].mindmap_integration,
                    children: [
                        { name: translations[currentLang].mindmap_study_room }, // e.g., Sub-Topic 1
                        { name: translations[currentLang].mindmap_flashcards }, // e.g., Sub-Topic 2
                        { name: translations[currentLang].mindmap_pomodoro }, // e.g., Sub-Topic 3
                    ]
                },
                {
                    name: translations[currentLang].mindmap_application,
                    children: [
                        { name: translations[currentLang].mindmap_active_recall }, // e.g., Implications
                        { name: translations[currentLang].mindmap_long_term_retention }, // e.g., Real-World Examples
                        { name: `Formula Output: O‚ÇÇ Production` }
                    ]
                }
            ]
        });


        window.generateMindMap = () => {
            const topicInput = document.getElementById('mindmap-topic-input').value.trim();
            const outputEl = document.getElementById('mindmap-output');
            const loadingEl = document.getElementById('mindmap-loading');
            const generateBtn = document.getElementById('generate-mindmap-btn');

            if (!topicInput) {
                outputEl.innerHTML = `<p class="text-red-500">${translations[currentLang].mindmap_no_topic_error}</p>`;
                return;
            }

            generateBtn.disabled = true;
            generateBtn.textContent = translations[currentLang].mindmap_analyzing;
            loadingEl.classList.remove('hidden');
            outputEl.innerHTML = '';
            outputEl.classList.add('opacity-50');

            setTimeout(() => {
                const data = getMindMapData(topicInput); // Use user input as the root
                renderMindMap(data, outputEl);

                loadingEl.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.textContent = translations[currentLang].mindmap_generate_map_button;
                outputEl.classList.remove('opacity-50');
            }, 3000);
        }

        function renderMindMap(data, container) {
            container.innerHTML = '';
            
            const rootNode = document.createElement('div');
            rootNode.className = 'mind-map-node node-level-0 max-w-full text-center';
            rootNode.textContent = data.root;
            container.appendChild(rootNode);

            const level1Container = document.createElement('div');
            level1Container.className = 'flex flex-wrap justify-center gap-6 mt-4 w-full';
            container.appendChild(level1Container);

            data.children.forEach(l1 => {
                const l1Column = document.createElement('div');
                l1Column.className = 'flex flex-col items-center space-y-3 p-3 rounded-lg border border-sage-green/50 dark:border-forest-green/50 w-full sm:w-auto min-w-[200px] max-w-[300px] shadow-sm';
                
                const l1Node = document.createElement('div');
                l1Node.className = 'mind-map-node node-level-1';
                l1Node.textContent = l1.name;
                l1Column.appendChild(l1Node);

                const l2Container = document.createElement('div');
                l2Container.className = 'flex flex-wrap justify-center gap-2 mt-2';
                l1Column.appendChild(l2Container);
                
                if (l1.children) {
                    l1.children.forEach(l2 => {
                        const l2Node = document.createElement('div');
                        l2Node.className = 'mind-map-node node-level-2 text-xs';
                        // Replaces the LaTeX-style output with HTML safe content (subscript)
                        let content = l2.name;
                        content = content.replace(/\$\text{C}_6\text{H}_{12}\text{O}_6\$/, 'C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ');
                        content = content.replace(/\$\text{H}_2\text{O}\$/, 'H‚ÇÇO');
                        content = content.replace(/\$\text{CO}_2\$/, 'CO‚ÇÇ');
                        content = content.replace(/\$\text{O}_2\$/, 'O‚ÇÇ');
                        l2Node.innerHTML = content;

                        l2Container.appendChild(l2Node);
                    });
                }
                level1Container.appendChild(l1Column);
            });
        }
        
        // --- Lofi Music Logic (YouTube Embed) (Unchanged) ---
        
        window.toggleLofi = () => {
            const iconEl = document.getElementById('lofi-icon');
            const embedBaseUrl = `https://www.youtube.com/embed/${YOUTUBE_VIDEO_ID}?autoplay=1&controls=0&loop=1&playlist=${YOUTUBE_VIDEO_ID}&enablejsapi=1&`;
            
            if (!lofiIframe) {
                lofiIframe = document.getElementById('lofi-iframe');
                lofiIframe.src = embedBaseUrl + 'mute=1';
                isLofiPlaying = true;
                isLofiMuted = true;
                
                iconEl.textContent = 'üîá'; 
                iconEl.classList.add('animate-pulse', 'text-warm-gold', 'dark:text-sage-green');
                return;
            }

            if (isLofiMuted) {
                lofiIframe.src = embedBaseUrl + 'mute=0';
                isLofiMuted = false;
                
                iconEl.textContent = 'üéß';
            } else {
                lofiIframe.src = embedBaseUrl + 'mute=1';
                isLofiMuted = true;
                
                iconEl.textContent = 'üé∂';
                iconEl.classList.remove('animate-pulse', 'text-warm-gold', 'dark:text-sage-green');
            }
        };

        // --- Falling Emojis Logic (Unchanged) ---

        function createFallingEmoji() {
            const container = document.getElementById('falling-elements-container');
            if (!container) return;

            const emoji = fallingEmojis[Math.floor(Math.random() * fallingEmojis.length)];
            const el = document.createElement('div');
            el.textContent = emoji;
            el.className = 'falling-emoji';
            
            const size = Math.random() * 15 + 15;
            const duration = Math.random() * 5 + 5; // 5s to 10s (SLOWER FALLING)
            const leftPosition = Math.random() * 100;
            const swayX = Math.random() * 50 - 25;
            const swayR = Math.random() * 360 - 180;

            el.style.left = `${leftPosition}%`;
            el.style.fontSize = `${size}px`;
            el.style.animationDuration = `${duration}s`;
            el.style.animationDelay = `-${Math.random() * 5}s`;
            
            el.style.setProperty('--sway-x', `${swayX}vw`);
            el.style.setProperty('--sway-r', `${swayR}deg`);

            container.appendChild(el);

            setTimeout(() => el.remove(), duration * 1000 + 1000); 
        }

        function startFallingEffect() {
            if (fallingInterval) clearInterval(fallingInterval);
            const container = document.getElementById('falling-elements-container');
            if (container) container.innerHTML = '';
            
            fallingInterval = setInterval(createFallingEmoji, 250); // 250ms (SLOWER GENERATION RATE)
        }

        // --- AI Storyteller Mock Logic (Unchanged) ---
        
        async function generateStory() {
            const inputEl = document.getElementById('story-input');
            const outputEl = document.getElementById('story-output');
            const loadingEl = document.getElementById('story-loading');
            const generateBtn = document.getElementById('generate-story-btn');
            const prompt = inputEl.value.trim();

            if (!prompt) {
                outputEl.textContent = translations[currentLang].storyteller_no_topic_error;
                return;
            }
            
            generateBtn.disabled = true;
            generateBtn.textContent = translations[currentLang].storyteller_connecting;
            loadingEl.classList.remove('hidden');
            outputEl.textContent = '';
            
            const mockStory = translations[currentLang].storyteller_mock_story.replace('{prompt}', prompt);
            
            try {
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                outputEl.textContent = mockStory;

            } catch (error) {
                console.error("AI Story Generation Error:", error);
                outputEl.textContent = translations[currentLang].storyteller_generation_error;
            } finally {
                loadingEl.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.textContent = translations[currentLang].storyteller_button;
            }
        }
        
        // --- Mood Dashboard Logic (Unchanged except for helper functions) ---

        window.setMood = (mood) => {
            selectedMood = mood;
            const buttons = document.querySelectorAll('.mood-option');
            buttons.forEach(btn => {
                btn.classList.remove('bg-sage-green/50', 'dark:bg-dark-bg-main/50', 'bg-forest-green/50');
                btn.classList.remove('border-forest-green', 'dark:border-sage-green', 'border-red-600');
                btn.classList.add('border-transparent');

                if (btn.dataset.mood === mood) {
                    btn.classList.add('bg-sage-green/50', 'dark:bg-dark-bg-main/50');
                    btn.style.borderColor = moodColors[mood];
                    btn.classList.remove('border-transparent');
                } else {
                    btn.style.borderColor = '';
                }
            });
        }

        function getMoodEntries() {
            try {
                const entries = JSON.parse(localStorage.getItem('moodEntries')) || [];
                return entries;
            } catch (e) {
                console.error("Error parsing mood entries from local storage", e);
                return [];
            }
        }

        function saveMoodEntries(entries) {
            localStorage.setItem('moodEntries', JSON.stringify(entries));
        }

        function renderRecentMoodCheckins() {
            const container = document.getElementById('recent-checkins');
            if (!container) return;

            const entries = getMoodEntries().slice(0, 5);
            container.innerHTML = '';
            
            if (entries.length === 0) {
                container.innerHTML = `<p class="text-center text-deep-charcoal/50 dark:text-off-white/50 italic">${translations[currentLang].mood_no_checkins}</p>`;
                return;
            }

            entries.forEach(entry => {
                const entryEl = document.createElement('div');
                const emoji = moodEmojis[entry.mood] || '‚ùì';
                const moodName = translations[currentLang][`mood_${entry.mood.toLowerCase()}`] || entry.mood;

                const colorCode = moodColors[entry.mood] || '#A9C7A0'; 

                entryEl.className = `p-4 rounded-xl shadow-md flex justify-between items-center bg-sage-green/30 dark:bg-dark-card-soft/50 border-l-4`;
                entryEl.style.borderColor = colorCode;

                const date = new Date(entry.timestamp).toLocaleDateString(currentLang);

                entryEl.innerHTML = `
                    <div>
                        <span class="text-lg font-bold flex items-center dark:text-off-white">
                            <span class="mr-2 text-2xl">${emoji}</span>
                            ${moodName}
                        </span>
                        <p class="text-sm text-deep-charcoal/70 dark:text-off-white/70 mt-1">
                            ${translations[currentLang].mood_energy_level_short}: ${entry.energy}/5 ${entry.notes ? `‚Äî "${entry.notes.substring(0, 30)}..."` : ''}
                        </p>
                    </div>
                    <span class="text-xs text-deep-charcoal/50 dark:text-off-white/50">${date}</span>
                `;
                container.appendChild(entryEl);
            });
        }

        window.logMoodEntry = () => {
            const energyValue = document.getElementById('energy-level').value;
            const notes = document.getElementById('mood-notes').value.trim();

            const newEntry = {
                id: generateId(),
                mood: selectedMood,
                energy: energyValue,
                notes: notes,
                timestamp: Date.now()
            };

            const entries = getMoodEntries();
            entries.unshift(newEntry);
            saveMoodEntries(entries);
            
            document.getElementById('energy-level').value = 3;
            document.getElementById('energy-value').textContent = 3;
            document.getElementById('mood-notes').value = '';
            setMood('Excellent');
            
            renderRecentMoodCheckins();
            
            showPage('dashboard-page');
        }

        // --- NEW: Groups Page Logic ---
        
        window.addStudyTopic = async () => {
            const inputEl = document.getElementById('group-topic-input');
            const messageEl = document.getElementById('groups-message');
            const topicName = inputEl.value.trim();

            messageEl.classList.add('hidden');

            if (topicName.length < 5) {
                messageEl.textContent = translations[currentLang].groups_input_error;
                messageEl.classList.remove('hidden');
                return;
            }

            if (!db || !userId) {
                messageEl.textContent = "Error: Please sign in (even mock sign in) to contribute to public topics.";
                messageEl.classList.remove('hidden');
                return;
            }

            const colRef = getGroupsCollectionRef();

            try {
                await firebase.addDoc(colRef, {
                    topicName: topicName,
                    userId: userId,
                    timestamp: firebase.serverTimestamp()
                });
                inputEl.value = '';
                messageEl.textContent = translations[currentLang].groups_add_success;
                messageEl.classList.remove('hidden');
                messageEl.classList.remove('text-red-600');
                messageEl.classList.add('text-forest-green');

            } catch (e) {
                console.error("Error adding document: ", e);
                messageEl.textContent = `Error sharing topic: ${e.message}`;
                messageEl.classList.remove('hidden');
                messageEl.classList.remove('text-forest-green');
                messageEl.classList.add('text-red-600');
            }
        }

        window.deleteTopic = async (topicId) => {
            if (!db || !userId) {
                console.error("Cannot delete: not authenticated.");
                return;
            }
            // Use a custom modal in a real app, but for this context, keep simple logic
            if (confirm("Are you sure you want to delete this shared topic?")) {
                const docRef = firebase.doc(getGroupsCollectionRef(), topicId);
                try {
                    await firebase.deleteDoc(docRef);
                } catch (e) {
                    console.error("Error deleting document: ", e);
                }
            }
        }

        function renderStudyGroups() {
            const container = document.getElementById('shared-topics-list');
            if (!container) return;
            container.innerHTML = '';

            if (sharedTopics.length === 0) {
                container.innerHTML = `<p class="text-center text-deep-charcoal/50 dark:text-off-white/50 italic">${translations[currentLang].groups_no_topics}</p>`;
                return;
            }

            sharedTopics.forEach(topic => {
                const topicEl = document.createElement('div');
                topicEl.className = `p-3 rounded-lg flex justify-between items-center bg-sage-green/10 dark:bg-dark-bg-main border border-sage-green/30 dark:border-forest-green/30 hover:shadow-md transition-shadow`;

                const formattedDate = topic.timestamp ? topic.timestamp.toLocaleDateString(currentLang, { year: 'numeric', month: 'short', day: 'numeric' }) : '';
                const displayUserId = topic.userId || 'Anonymous';
                
                topicEl.innerHTML = `
                    <div class="flex flex-col flex-grow min-w-0 pr-4">
                        <p class="font-bold text-lg text-forest-green dark:text-warm-gold truncate" title="${topic.topicName}">${topic.topicName}</p>
                        <p class="text-xs text-deep-charcoal/60 dark:text-off-white/60 mt-1">
                            Shared by: <span class="font-mono text-[10px]">${displayUserId}</span> on ${formattedDate}
                        </p>
                    </div>
                `;

                // Add delete button only if the current user created it (mock logic or actual UID check)
                if (topic.userId === userId) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = translations[currentLang].groups_delete || 'Delete';
                    deleteBtn.className = 'bg-red-500 text-off-white text-xs py-1 px-3 rounded-full hover:bg-red-600 transition ml-4';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        deleteTopic(topic.id);
                    };
                    topicEl.appendChild(deleteBtn);
                }
                
                container.appendChild(topicEl);
            });
        }
        
        // --- NEW: Progress Page Logic (Chart Mock) ---

        const mockWeeklyData = [3, 5, 8, 7, 10, 4, 1]; // Pomodoros completed per day (Mon-Sun)

        function renderWeeklyChart() {
            const container = document.getElementById('weekly-chart');
            if (!container) return;

            // Update streak/total metrics (in case they were manually changed via localStorage)
            document.getElementById('progress-streak-display').textContent = localStorage.getItem('studyStreak') || '0';
            document.getElementById('progress-pomodoros-today').textContent = pomodorosCompleted.toString();
            document.getElementById('progress-total-sessions-display').textContent = localStorage.getItem('totalFocusSessions') || '12';

            container.innerHTML = '';
            
            const maxPomodoros = Math.max(...mockWeeklyData, 10);
            const todayIndex = (new Date().getDay() + 6) % 7; // Convert Sun(0)-Sat(6) to Mon(0)-Sun(6) with Monday start

            mockWeeklyData.forEach((count, index) => {
                const heightPercentage = (count / maxPomodoros) * 100;
                const isToday = index === todayIndex;

                const bar = document.createElement('div');
                bar.className = `bar-chart-bar relative bg-forest-green dark:bg-sage-green group flex justify-center`;
                bar.style.height = `${heightPercentage}%`;

                if (isToday) {
                    bar.classList.add('bg-warm-gold', 'dark:bg-warm-gold');
                }

                bar.innerHTML = `
                    <span class="absolute top-[-25px] text-xs font-bold text-deep-charcoal dark:text-off-white transition-opacity opacity-0 group-hover:opacity-100">${count}</span>
                `;
                bar.title = `${count} Pomodoros`; // Tooltip
                container.appendChild(bar);
            });
        }
        
        // --- NEW: Collaboration/Peer Match Logic (Vidyut Mitra) ---
        
        /** Simulates finding a study partner based on the user's free-text input. */
        window.simulatePeerMatch = () => {
            const inputEl = document.getElementById('peer-match-topic-input');
            const outputEl = document.getElementById('match-output');
            const loadingEl = document.getElementById('match-loading');
            const findBtn = document.getElementById('find-mitra-btn');
            
            const selectedTopic = inputEl.value.trim();
            
            outputEl.innerHTML = '';
            outputEl.classList.remove('bg-sage-green/10', 'border-sage-green/50', 'bg-red-100', 'border-red-500', 'dark:bg-dark-bg-main', 'dark:border-forest-green', 'dark:bg-red-900/50', 'dark:border-red-400');


            if (!selectedTopic || selectedTopic.length < 3) {
                outputEl.innerHTML = `<p class="text-red-500">Please enter a topic with at least 3 characters to start searching!</p>`;
                outputEl.classList.add('bg-red-100', 'border-red-500', 'dark:bg-red-900/50', 'dark:border-red-400');
                return;
            }

            findBtn.disabled = true;
            findBtn.textContent = translations[currentLang].peer_match_loading_text;
            loadingEl.classList.remove('hidden');

            setTimeout(() => {
                findBtn.disabled = false;
                findBtn.textContent = translations[currentLang].peer_match_find_button;
                loadingEl.classList.add('hidden');
                
                // --- Match Logic Simulation (Highly likely to find a match for UX) ---
                // Mock profiles generated based on search topic
                
                const matchFound = Math.random() > 0.1; // 90% chance to find a match
                
                if (matchFound) {
                    const mockProfile = {
                        name: `Mitra-${generateId().substring(0, 5)}`,
                        status: Math.random() > 0.5 ? 'Online' : 'Focused',
                        topic: selectedTopic
                    };

                    outputEl.classList.add('bg-sage-green/10', 'border-sage-green/50', 'dark:bg-dark-bg-main', 'dark:border-forest-green');
                    outputEl.innerHTML = `
                        <p class="text-xl font-bold text-forest-green dark:text-warm-gold mb-3 flex items-center">
                            <span class="text-3xl mr-2">ü§ù</span> ${translations[currentLang].peer_match_found}
                        </p>
                        <div class="p-3 bg-off-white/70 dark:bg-dark-card-soft rounded-lg shadow-inner">
                            <p class="font-bold">Peer Name: ${mockProfile.name}</p>
                            <p class="text-sm text-deep-charcoal/80 dark:text-off-white/80">Focused on: ${mockProfile.topic}</p>
                            <p class="text-xs ${mockProfile.status === 'Online' ? 'text-green-600' : 'text-amber-500'}">Status: ${mockProfile.status} (In Session)</p>
                            <button class="mt-3 w-full bg-warm-gold text-deep-charcoal font-bold py-2 rounded-full hover:bg-warm-gold/90 transition" onclick="alert('Simulating joining a virtual chat room for: ${mockProfile.topic}');">
                                ${translations[currentLang].peer_match_join_chat}
                            </button>
                        </div>
                    `;
                    
                } else {
                    outputEl.classList.add('bg-red-100', 'border-red-500', 'dark:bg-red-900/50', 'dark:border-red-400');
                    outputEl.innerHTML = `<p class="text-deep-charcoal dark:text-off-white">${translations[currentLang].peer_match_no_match}</p>`;
                }
                
            }, 3000); // 3 second mock latency
        }


        // --- View and Initialization ---

        window.showPage = (pageId) => {
            const pages = ['homepage', 'features-page', 'about-page', 'memory-palace-page', 'dashboard-page', 'mood-dashboard-page', 'progress-page', 'groups-page'];
            pages.forEach(id => {
                const pageElement = document.getElementById(id);
                if (pageElement) {
                    pageElement.style.opacity = 0; 
                    setTimeout(() => {
                        pageElement.classList.add('hidden');
                        if (id === pageId) {
                            pageElement.classList.remove('hidden');
                            void pageElement.offsetWidth;
                            pageElement.style.opacity = 1; 
                            
                            if (pageId === 'memory-palace-page' && isAuthReady) {
                                renderPalaceCanvas();
                            } else if (pageId === 'dashboard-page') {
                                initializeDashboardMetrics(); 
                                updateDisplay(); 
                            } else if (pageId === 'features-page') {
                                renderFlashcard();
                            } else if (pageId === 'mood-dashboard-page') {
                                setMood(selectedMood);
                                renderRecentMoodCheckins();
                            } else if (pageId === 'progress-page') { // NEW PAGE
                                renderWeeklyChart();
                            } else if (pageId === 'groups-page') { // NEW PAGE
                                renderStudyGroups();
                            }
                        }
                    }, 500); 
                }
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.onload = async () => {
            // Initialize language setting first
            currentLang = localStorage.getItem('language') || 'en';
            document.getElementById('lang-selector').value = currentLang;
            translateUI(currentLang);
            
            await new Promise(resolve => setTimeout(resolve, 0));

            initializeDarkMode();
            await initializeFirebaseAndAuth();
            
            // Set initial values for Pomodoro/Streak and Duration
            pomodorosCompleted = parseInt(localStorage.getItem('pomodorosCompleted') || '0', 10);
            dailyTarget = parseInt(localStorage.getItem('dailyTarget') || '4', 10);
            focusDuration = parseInt(localStorage.getItem('focusDuration') || '25', 10); // Load focus duration
            localStorage.setItem('studyStreak', localStorage.getItem('studyStreak') || '4');
            localStorage.setItem('totalFocusSessions', localStorage.getItem('totalFocusSessions') || '12');
            
            const targetInput = document.getElementById('daily-pomodoros-target');
            if (targetInput) targetInput.value = dailyTarget;

            const durationInput = document.getElementById('focus-duration-input');
            if (durationInput) durationInput.value = focusDuration;

            totalSeconds = focusDuration * 60; // Initialize totalSeconds using focusDuration

            const addCompBtn = document.getElementById('add-compartment-btn');
            const addNoteBtn = document.getElementById('add-note-btn');
            if (addCompBtn) addCompBtn.onclick = addCompartment;
            if (addNoteBtn) addNoteBtn.onclick = addNote;
            
            const startBtn = document.getElementById('pomodoro-start');
            const resetBtn = document.getElementById('pomodoro-reset');
            // The start button logic is now handled by toggleTimer globally
            if (startBtn) startBtn.onclick = toggleTimer; 
            if (resetBtn) resetBtn.onclick = resetTimer;
            document.addEventListener('visibilitychange', checkVisibility);
            
            const storyBtn = document.getElementById('generate-story-btn');
            if (storyBtn) storyBtn.onclick = generateStory;

            const generateCardsBtn = document.getElementById('generate-cards-btn-dashboard');
            if (generateCardsBtn) generateCardsBtn.onclick = triggerFlashcardGeneration;

            const summarizeBtn = document.getElementById('summarizer-btn');
            if (summarizeBtn) summarizeBtn.onclick = triggerSummarizer;

            const mindmapBtn = document.getElementById('generate-mindmap-btn');
            if (mindmapBtn) mindmapBtn.onclick = generateMindMap;

            // NEW Group/Mood Actions
            const addTopicBtn = document.getElementById('add-topic-btn');
            if (addTopicBtn) addTopicBtn.onclick = addStudyTopic;
            
            startFallingEffect();
            
            setMood(selectedMood);
            updateDisplay(); 
            renderFlashcard();
            
            showPage('homepage');
        };
    </script>
</body>
</html>

